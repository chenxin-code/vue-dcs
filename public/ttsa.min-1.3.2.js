"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},t(e,r)};var r=function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};function n(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function o(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function i(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var s=i((function(e,t){e.exports=function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){function n(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,n=o(e),i=n.source,d=n.id,u=n.path,p=c[d]&&u in c[d].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||p?(a("ignoring socket cache for %s",i),r=s(i,t)):(c[d]||(a("new io instance for %s",i),c[d]=s(i,t)),r=c[d]),n.query&&!t.query&&(t.query=n.query),r.socket(n.path,t)}var o=r(1),i=r(7),s=r(15),a=r(3)("socket.io-client");e.exports=t=n;var c=t.managers={};t.protocol=i.protocol,t.connect=n,t.Manager=r(15),t.Socket=r(39)},function(e,t,r){function n(e,t){var r=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),r=o(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var n=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+n+":"+r.port,r.href=r.protocol+"://"+n+(t&&t.port===r.port?"":":"+r.port),r}var o=r(2),i=r(3)("socket.io-client:url");e.exports=n},function(e,t){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,o=e.indexOf("["),i=e.indexOf("]");-1!=o&&-1!=i&&(e=e.substring(0,o)+e.substring(o,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=r.exec(e||""),a={},c=14;c--;)a[n[c]]=s[c]||"";return-1!=o&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t,r){(function(n){function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function i(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(o=n))})),t.splice(o,0,r)}}function s(){var e;return"object"===("undefined"==typeof console?"undefined":u(console))&&console.log&&(e=console).log.apply(e,arguments)}function a(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}}function c(){var e=void 0;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}function d(){try{return localStorage}catch(e){}}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.log=s,t.formatArgs=i,t.save=a,t.load=c,t.useColors=o,t.storage=d(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(5)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(t,r(4))},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(e){if(u===setTimeout)return setTimeout(e,0);if((u===r||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function i(e){if(p===clearTimeout)return clearTimeout(e);if((p===n||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function s(){m&&f&&(m=!1,f.length?h=f.concat(h):g=-1,h.length&&a())}function a(){if(!m){var e=o(s);m=!0;for(var t=h.length;t;){for(f=h,h=[];++g<t;)f&&f[g].run();g=-1,t=h.length}f=null,m=!1,i(e)}}function c(e,t){this.fun=e,this.array=t}function d(){}var u,p,l=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:r}catch(e){u=r}try{p="function"==typeof clearTimeout?clearTimeout:n}catch(e){p=n}}();var f,h=[],m=!1,g=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new c(e,t)),1!==h.length||m||o(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=d,l.addListener=d,l.once=d,l.off=d,l.removeListener=d,l.removeAllListeners=d,l.emit=d,l.prependListener=d,l.prependOnceListener=d,l.listeners=function(e){return[]},l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t,r){function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function o(e){function t(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return o.colors[Math.abs(t)%o.colors.length]}function o(e){function r(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(r.enabled){var s=r,a=Number(new Date),c=a-(n||a);s.diff=c,s.prev=n,s.curr=a,n=a,t[0]=o.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var d=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return e;d++;var n=o.formatters[r];if("function"==typeof n){var i=t[d];e=n.call(s,i),t.splice(d,1),d--}return e})),o.formatArgs.call(s,t),(s.log||o.log).apply(s,t)}}var n=void 0;return r.namespace=e,r.enabled=o.enabled(e),r.useColors=o.useColors(),r.color=t(e),r.destroy=i,r.extend=s,"function"==typeof o.init&&o.init(r),o.instances.push(r),r}function i(){var e=o.instances.indexOf(this);return-1!==e&&(o.instances.splice(e,1),!0)}function s(e,t){var r=o(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function a(e){o.save(e),o.names=[],o.skips=[];var t=void 0,r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?o.skips.push(new RegExp("^"+e.substr(1)+"$")):o.names.push(new RegExp("^"+e+"$")));for(t=0;t<o.instances.length;t++){var i=o.instances[t];i.enabled=o.enabled(i.namespace)}}function c(){var e=[].concat(n(o.names.map(u)),n(o.skips.map(u).map((function(e){return"-"+e})))).join(",");return o.enable(""),e}function d(e){if("*"===e[e.length-1])return!0;var t=void 0,r=void 0;for(t=0,r=o.skips.length;t<r;t++)if(o.skips[t].test(e))return!1;for(t=0,r=o.names.length;t<r;t++)if(o.names[t].test(e))return!0;return!1}function u(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}function p(e){return e instanceof Error?e.stack||e.message:e}return o.debug=o,o.default=o,o.coerce=p,o.disable=c,o.enable=a,o.enabled=d,o.humanize=r(6),Object.keys(e).forEach((function(t){o[t]=e[t]})),o.instances=[],o.names=[],o.skips=[],o.formatters={},o.selectColor=t,o.enable(o.load()),o}e.exports=o},function(e,t){function r(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*p;case"weeks":case"week":case"w":return r*u;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*c;case"minutes":case"minute":case"mins":case"min":case"m":return r*a;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function n(e){var t=Math.abs(e);return t>=d?Math.round(e/d)+"d":t>=c?Math.round(e/c)+"h":t>=a?Math.round(e/a)+"m":t>=s?Math.round(e/s)+"s":e+"ms"}function o(e){var t=Math.abs(e);return t>=d?i(e,t,d,"day"):t>=c?i(e,t,c,"hour"):t>=a?i(e,t,a,"minute"):t>=s?i(e,t,s,"second"):e+" ms"}function i(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}var s=1e3,a=60*s,c=60*a,d=24*c,u=7*d,p=365.25*d;e.exports=function(e,t){t=t||{};var i=typeof e;if("string"===i&&e.length>0)return r(e);if("number"===i&&isFinite(e))return t.long?o(e):n(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){function n(){}function o(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var n=i(e.data);if(!1===n)return v;r+=n}return l("encoded %j as %s",e,r),r}function i(e){try{return JSON.stringify(e)}catch(e){return!1}}function s(e,t){function r(e){var r=h.deconstructPacket(e),n=o(r.packet),i=r.buffers;i.unshift(n),t(i)}h.removeBlobs(e,r)}function a(){this.reconstructor=null}function c(e){var r=0,n={type:Number(e.charAt(0))};if(null==t.types[n.type])return p("unknown packet type "+n.type);if(t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type){for(var o="";"-"!==e.charAt(++r)&&(o+=e.charAt(r),r!=e.length););if(o!=Number(o)||"-"!==e.charAt(r))throw new Error("Illegal attachments");n.attachments=Number(o)}if("/"===e.charAt(r+1))for(n.nsp="";++r&&","!==(s=e.charAt(r))&&(n.nsp+=s,r!==e.length););else n.nsp="/";var i=e.charAt(r+1);if(""!==i&&Number(i)==i){for(n.id="";++r;){var s;if(null==(s=e.charAt(r))||Number(s)!=s){--r;break}if(n.id+=e.charAt(r),r===e.length)break}n.id=Number(n.id)}if(e.charAt(++r)){var a=d(e.substr(r));if(!1===a||n.type!==t.ERROR&&!m(a))return p("invalid payload");n.data=a}return l("decoded %s as %j",e,n),n}function d(e){try{return JSON.parse(e)}catch(e){return!1}}function u(e){this.reconPack=e,this.buffers=[]}function p(e){return{type:t.ERROR,data:"parser error: "+e}}var l=r(8)("socket.io-parser"),f=r(11),h=r(12),m=r(13),g=r(14);t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=n,t.Decoder=a;var v=t.ERROR+'"encode error"';n.prototype.encode=function(e,r){l("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type?s(e,r):r([o(e)])},f(a.prototype),a.prototype.add=function(e){var r;if("string"==typeof e)r=c(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new u(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!g(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},u.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=h.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,r){(function(n){function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function i(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),r){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))})),e.splice(i,0,n)}}function s(){return"object"===("undefined"==typeof console?"undefined":u(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function c(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}function d(){try{return window.localStorage}catch(e){}}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(t=e.exports=r(9)).log=s,t.formatArgs=i,t.save=a,t.load=c,t.useColors=o,t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:d(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(c())}).call(t,r(4))},function(e,t,r){function n(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}function o(e){function r(){if(r.enabled){var e=r,n=+new Date,i=n-(o||n);e.diff=i,e.prev=o,e.curr=n,o=n;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(r,n){if("%%"===r)return r;c++;var o=t.formatters[n];if("function"==typeof o){var i=s[c];r=o.call(e,i),s.splice(c,1),c--}return r})),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}var o;return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=n(e),r.destroy=i,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function s(e){t.save(e),t.names=[],t.skips=[];var r,n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){var i=t.instances[r];i.enabled=t.enabled(i.namespace)}}function a(){t.enable("")}function c(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1}function d(e){return e instanceof Error?e.stack||e.message:e}(t=e.exports=o.debug=o.default=o).coerce=d,t.disable=a,t.enable=s,t.enabled=c,t.humanize=r(10),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function r(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*u;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*c;case"minutes":case"minute":case"mins":case"min":case"m":return r*a;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function n(e){return e>=d?Math.round(e/d)+"d":e>=c?Math.round(e/c)+"h":e>=a?Math.round(e/a)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function o(e){return i(e,d,"day")||i(e,c,"hour")||i(e,a,"minute")||i(e,s,"second")||e+" ms"}function i(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var s=1e3,a=60*s,c=60*a,d=24*c,u=365.25*d;e.exports=function(e,t){t=t||{};var i=typeof e;if("string"===i&&e.length>0)return r(e);if("number"===i&&!1===isNaN(e))return t.long?o(e):n(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){function n(e){if(e)return o(e)}function o(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var n,o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,o=(r=r.slice(0)).length;n<o;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){function n(e,t){if(!e)return e;if(s(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}if(i(e)){for(var o=new Array(e.length),a=0;a<e.length;a++)o[a]=n(e[a],t);return o}if("object"==typeof e&&!(e instanceof Date)){for(var c in o={},e)o[c]=n(e[c],t);return o}return e}function o(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(i(e))for(var r=0;r<e.length;r++)e[r]=o(e[r],t);else if("object"==typeof e)for(var n in e)e[n]=o(e[n],t);return e}var i=r(13),s=r(14),a=Object.prototype.toString,c="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===a.call(Blob),d="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===a.call(File);t.deconstructPacket=function(e){var t=[],r=e.data,o=e;return o.data=n(r,t),o.attachments=t.length,{packet:o,buffers:t}},t.reconstructPacket=function(e,t){return e.data=o(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){function r(e,a,u){if(!e)return e;if(c&&e instanceof Blob||d&&e instanceof File){n++;var p=new FileReader;p.onload=function(){u?u[a]=this.result:o=this.result,--n||t(o)},p.readAsArrayBuffer(e)}else if(i(e))for(var l=0;l<e.length;l++)r(e[l],l,e);else if("object"==typeof e&&!s(e))for(var f in e)r(e[f],f,e)}var n=0,o=e;r(o),n||t(o)}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t){function r(e){return n&&Buffer.isBuffer(e)||o&&(e instanceof ArrayBuffer||i(e))}e.exports=r;var n="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,o="function"==typeof ArrayBuffer,i=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}},function(e,t,r){function n(e,t){if(!(this instanceof n))return new n(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||a;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}var o=r(16),i=r(39),s=r(11),a=r(7),c=r(41),d=r(42),u=r(3)("socket.io-client:manager"),p=r(38),l=r(43),f=Object.prototype.hasOwnProperty;e.exports=n,n.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},n.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},n.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},s(n.prototype),n.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},n.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},n.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},n.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},n.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},n.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},n.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},n.prototype.open=n.prototype.connect=function(e,t){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=o(this.uri,this.opts);var r=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=c(r,"open",(function(){n.onopen(),e&&e()})),s=c(r,"error",(function(t){if(u("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else n.maybeReconnectOnOpen()}));if(!1!==this._timeout){var a=this._timeout;u("connect attempt will timeout after %d",a);var d=setTimeout((function(){u("connect attempt timed out after %d",a),i.destroy(),r.close(),r.emit("error","timeout"),n.emitAll("connect_timeout",a)}),a);this.subs.push({destroy:function(){clearTimeout(d)}})}return this.subs.push(i),this.subs.push(s),this},n.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",d(this,"ondata"))),this.subs.push(c(e,"ping",d(this,"onping"))),this.subs.push(c(e,"pong",d(this,"onpong"))),this.subs.push(c(e,"error",d(this,"onerror"))),this.subs.push(c(e,"close",d(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",d(this,"ondecoded")))},n.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},n.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},n.prototype.ondata=function(e){this.decoder.add(e)},n.prototype.ondecoded=function(e){this.emit("packet",e)},n.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},n.prototype.socket=function(e,t){function r(){~p(o.connecting,n)||o.connecting.push(n)}var n=this.nsps[e];if(!n){n=new i(this,e,t),this.nsps[e]=n;var o=this;n.on("connecting",r),n.on("connect",(function(){n.id=o.generateId(e)})),this.autoConnect&&r()}return n},n.prototype.destroy=function(e){var t=p(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},n.prototype.packet=function(e){u("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()})))},n.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},n.prototype.cleanup=function(){u("cleanup");for(var e=this.subs.length,t=0;t<e;t++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},n.prototype.close=n.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},n.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},n.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout((function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(r)}})}},n.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,r){e.exports=r(17),e.exports.parser=r(24)},function(e,t,r){function n(e,t){return this instanceof n?(t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=u(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=u(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=p.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=!1!==t.withCredentials,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,void this.open()):new n(e,t)}function o(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}var i=r(18),s=r(11),a=r(3)("engine.io-client:socket"),c=r(38),d=r(24),u=r(2),p=r(32);e.exports=n,n.priorWebsocketSuccess=!1,s(n.prototype),n.protocol=d.protocol,n.Socket=n,n.Transport=r(23),n.transports=r(18),n.parser=r(24),n.prototype.createTransport=function(e){a('creating transport "%s"',e);var t=o(this.query);t.EIO=d.protocol,t.transport=e;var r=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new i[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative})},n.prototype.open=function(){var e;if(this.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},n.prototype.setTransport=function(e){a("setting transport %s",e.name);var t=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},n.prototype.probe=function(e){function t(){if(l.onlyBinaryUpgrades){var t=!this.supportsBinary&&l.transport.supportsBinary;p=p||t}p||(a('probe transport "%s" opened',e),u.send([{type:"ping",data:"probe"}]),u.once("packet",(function(t){if(!p)if("pong"===t.type&&"probe"===t.data){if(a('probe transport "%s" pong',e),l.upgrading=!0,l.emit("upgrading",u),!u)return;n.priorWebsocketSuccess="websocket"===u.name,a('pausing current transport "%s"',l.transport.name),l.transport.pause((function(){p||"closed"!==l.readyState&&(a("changing transport and sending upgrade packet"),d(),l.setTransport(u),u.send([{type:"upgrade"}]),l.emit("upgrade",u),u=null,l.upgrading=!1,l.flush())}))}else{a('probe transport "%s" failed',e);var r=new Error("probe error");r.transport=u.name,l.emit("upgradeError",r)}})))}function r(){p||(p=!0,d(),u.close(),u=null)}function o(t){var n=new Error("probe error: "+t);n.transport=u.name,r(),a('probe transport "%s" failed because of error: %s',e,t),l.emit("upgradeError",n)}function i(){o("transport closed")}function s(){o("socket closed")}function c(e){u&&e.name!==u.name&&(a('"%s" works - aborting "%s"',e.name,u.name),r())}function d(){u.removeListener("open",t),u.removeListener("error",o),u.removeListener("close",i),l.removeListener("close",s),l.removeListener("upgrading",c)}a('probing transport "%s"',e);var u=this.createTransport(e,{probe:1}),p=!1,l=this;n.priorWebsocketSuccess=!1,u.once("open",t),u.once("error",o),u.once("close",i),this.once("close",s),this.once("upgrading",c),u.open()},n.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},n.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)},n.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},n.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},n.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){a("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},n.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},n.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},n.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},n.prototype.write=n.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},n.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var o={type:e,data:t,options:r};this.emit("packetCreate",o),this.writeBuffer.push(o),n&&this.once("flush",n),this.flush()}},n.prototype.close=function(){function e(){n.onClose("forced close"),a("socket closing - telling transport to close"),n.transport.close()}function t(){n.removeListener("upgrade",t),n.removeListener("upgradeError",t),e()}function r(){n.once("upgrade",t),n.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var n=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():e()})):this.upgrading?r():e()}return this},n.prototype.onError=function(e){a("socket error %j",e),n.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},n.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){a('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},n.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~c(this.transports,e[r])&&t.push(e[r]);return t}},function(e,t,r){function n(e){var t=!1,r=!1,n=!1!==e.jsonp;if("undefined"!=typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),t=e.hostname!==location.hostname||c!==e.port,r=e.secure!==a}if(e.xdomain=t,e.xscheme=r,"open"in new o(e)&&!e.forceJSONP)return new i(e);if(!n)throw new Error("JSONP disabled");return new s(e)}var o=r(19),i=r(21),s=r(35),a=r(36);t.polling=n,t.websocket=a},function(e,t,r){var n=r(20);e.exports=function(e){var t=e.xdomain,r=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&o)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,r){function n(){}function o(e){if(c.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,r=location.port;r||(r=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}}function i(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function s(){for(var e in i.requests)i.requests.hasOwnProperty(e)&&i.requests[e].abort()}var a=r(19),c=r(22),d=r(11),u=r(33),p=r(3)("engine.io-client:polling-xhr");if(e.exports=o,e.exports.Request=i,u(o,c),o.prototype.supportsBinary=!0,o.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new i(e)},o.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),o=this;n.on("success",t),n.on("error",(function(e){o.onError("xhr post error",e)})),this.sendXhr=n},o.prototype.doPoll=function(){p("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},d(i.prototype),i.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new a(e),r=this;try{p("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var n in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.extraHeaders[n])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");(r.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?r.onLoad():setTimeout((function(){r.onError("number"==typeof t.status?t.status:0)}),0))},p("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){r.onError(e)}),0)}"undefined"!=typeof document&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},i.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},i.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=n:this.xhr.onreadystatechange=n,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete i.requests[this.index],this.xhr=null}},i.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e=("application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},i.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},i.prototype.abort=function(){this.cleanup()},i.requestsCount=0,i.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",s);else if("function"==typeof addEventListener){var l="onpagehide"in self?"pagehide":"unload";addEventListener(l,s,!1)}},function(e,t,r){function n(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),o.call(this,e)}var o=r(23),i=r(32),s=r(24),a=r(33),c=r(34),d=r(3)("engine.io-client:polling");e.exports=n;var u=null!=new(r(19))({xdomain:!1}).responseType;a(n,o),n.prototype.name="polling",n.prototype.doOpen=function(){this.poll()},n.prototype.pause=function(e){function t(){d("paused"),r.readyState="paused",e()}var r=this;if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(d("we are currently polling - waiting to pause"),n++,this.once("pollComplete",(function(){d("pre-pause polling complete"),--n||t()}))),this.writable||(d("we are currently writing - waiting to pause"),n++,this.once("drain",(function(){d("pre-pause writing complete"),--n||t()})))}else t()},n.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},n.prototype.onData=function(e){var t=this;d("polling got data %s",e);var r=function(e,r,n){return"opening"===t.readyState&&t.onOpen(),"close"===e.type?(t.onClose(),!1):void t.onPacket(e)};s.decodePayload(e,this.socket.binaryType,r),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},n.prototype.doClose=function(){function e(){d("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(d("transport open - closing"),e()):(d("transport not open - deferring close"),this.once("open",e))},n.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};s.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,r)}))},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},function(e,t,r){function n(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var o=r(24),i=r(11);e.exports=n,i(n.prototype),n.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},n.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},n.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},n.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},n.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},n.prototype.onData=function(e){var t=o.decodePacket(e,this.socket.binaryType);this.onPacket(t)},n.prototype.onPacket=function(e){this.emit("packet",e)},n.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,r){function n(e,r){return r("b"+t.packets[e.type]+e.data.data)}function o(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var o=e.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=y[e.type];for(var a=0;a<i.length;a++)s[a+1]=i[a];return n(s.buffer)}function i(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var o=new FileReader;return o.onload=function(){t.encodePacket({type:e.type,data:o.result},r,!0,n)},o.readAsArrayBuffer(e.data)}function s(e,r,n){if(!r)return t.encodeBase64Packet(e,n);if(v)return i(e,r,n);var o=new Uint8Array(1);return o[0]=y[e.type],n(new w([o.buffer,e.data]))}function a(e){try{e=h.decode(e,{strict:!1})}catch(e){return!1}return e}function c(e,t,r){for(var n=new Array(e.length),o=f(e.length,r),i=function(e,r,o){t(r,(function(t,r){n[e]=r,o(t,n)}))},s=0;s<e.length;s++)i(s,e[s],o)}var d,u=r(25),p=r(26),l=r(27),f=r(28),h=r(29);"undefined"!=typeof ArrayBuffer&&(d=r(30));var m="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),g="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),v=m||g;t.protocol=3;var y=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},b=u(y),C={type:"error",data:"parser error"},w=r(31);t.encodePacket=function(e,t,r,i){"function"==typeof t&&(i=t,t=!1),"function"==typeof r&&(i=r,r=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return o(e,t,i);if(void 0!==w&&a instanceof w)return s(e,t,i);if(a&&a.base64)return n(e,i);var c=y[e.type];return void 0!==e.data&&(c+=r?h.encode(String(e.data),{strict:!1}):String(e.data)),i(""+c)},t.encodeBase64Packet=function(e,r){var n,o="b"+t.packets[e.type];if(void 0!==w&&e.data instanceof w){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];r(o+e)},i.readAsDataURL(e.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),a=new Array(s.length),c=0;c<s.length;c++)a[c]=s[c];n=String.fromCharCode.apply(null,a)}return o+=btoa(n),r(o)},t.decodePacket=function(e,r,n){if(void 0===e)return C;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),r);if(n&&!1===(e=a(e)))return C;var o=e.charAt(0);return Number(o)==o&&b[o]?e.length>1?{type:b[o],data:e.substring(1)}:{type:b[o]}:C}o=new Uint8Array(e)[0];var i=l(e,1);return w&&"blob"===r&&(i=new w([i])),{type:b[o],data:i}},t.decodeBase64Packet=function(e,t){var r=b[e.charAt(0)];if(!d)return{type:r,data:{base64:!0,data:e.substr(1)}};var n=d.decode(e.substr(1));return"blob"===t&&w&&(n=new w([n])),{type:r,data:n}},t.encodePayload=function(e,r,n){function o(e){return e.length+":"+e}function i(e,n){t.encodePacket(e,!!s&&r,!1,(function(e){n(null,o(e))}))}"function"==typeof r&&(n=r,r=null);var s=p(e);return r&&s?w&&!v?t.encodePayloadAsBlob(e,n):t.encodePayloadAsArrayBuffer(e,n):e.length?void c(e,i,(function(e,t){return n(t.join(""))})):n("0:")},t.decodePayload=function(e,r,n){if("string"!=typeof e)return t.decodePayloadAsBinary(e,r,n);var o;if("function"==typeof r&&(n=r,r=null),""===e)return n(C,0,1);for(var i,s,a="",c=0,d=e.length;c<d;c++){var u=e.charAt(c);if(":"===u){if(""===a||a!=(i=Number(a)))return n(C,0,1);if(a!=(s=e.substr(c+1,i)).length)return n(C,0,1);if(s.length){if(o=t.decodePacket(s,r,!1),C.type===o.type&&C.data===o.data)return n(C,0,1);if(!1===n(o,c+i,d))return}c+=i,a=""}else a+=u}return""!==a?n(C,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,r){function n(e,r){t.encodePacket(e,!0,!0,(function(e){return r(null,e)}))}return e.length?void c(e,n,(function(e,t){var n=t.reduce((function(e,t){var r;return e+(r="string"==typeof t?t.length:t.byteLength).toString().length+r+2}),0),o=new Uint8Array(n),i=0;return t.forEach((function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),s=0;s<e.length;s++)n[s]=e.charCodeAt(s);r=n.buffer}o[i++]=t?0:1;var a=r.byteLength.toString();for(s=0;s<a.length;s++)o[i++]=parseInt(a[s]);for(o[i++]=255,n=new Uint8Array(r),s=0;s<n.length;s++)o[i++]=n[s]})),r(o.buffer)})):r(new ArrayBuffer(0))},t.encodePayloadAsBlob=function(e,r){function n(e,r){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);e=n.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(i.length+1);for(o=0;o<i.length;o++)s[o]=parseInt(i[o]);if(s[i.length]=255,w){var a=new w([t.buffer,s.buffer,e]);r(null,a)}}))}c(e,n,(function(e,t){return r(new w(t))}))},t.decodePayloadAsBinary=function(e,r,n){"function"==typeof r&&(n=r,r=null);for(var o=e,i=[];o.byteLength>0;){for(var s=new Uint8Array(o),a=0===s[0],c="",d=1;255!==s[d];d++){if(c.length>310)return n(C,0,1);c+=s[d]}o=l(o,2+c.length),c=parseInt(c);var u=l(o,0,c);if(a)try{u=String.fromCharCode.apply(null,new Uint8Array(u))}catch(e){var p=new Uint8Array(u);for(u="",d=0;d<p.length;d++)u+=String.fromCharCode(p[d])}i.push(u),o=l(o,c)}var f=i.length;i.forEach((function(e,o){n(t.decodePacket(e,r,!0),o,f)}))}},function(e,t){e.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},function(e,t,r){function n(e){if(!e||"object"!=typeof e)return!1;if(o(e)){for(var t=0,r=e.length;t<r;t++)if(n(e[t]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||s&&e instanceof Blob||a&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return n(e.toJSON(),!0);for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&n(e[i]))return!0;return!1}var o=r(13),i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);e.exports=n},function(e,t){e.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(r-t),s=t,a=0;s<r;s++,a++)i[a]=o[s];return i.buffer}},function(e,t){function r(e,t,r){function o(e,n){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(i=!0,t(e),t=r):0!==o.count||i||t(null,n)}var i=!1;return r=r||n,o.count=e,0===e?t():o}function n(){}e.exports=r},function(e,t){function r(e){for(var t,r,n=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function n(e){for(var t,r=e.length,n=-1,o="";++n<r;)(t=e[n])>65535&&(o+=h((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=h(t);return o}function o(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function i(e,t){return h(e>>t&63|128)}function s(e,t){if(0==(4294967168&e))return h(e);var r="";return 0==(4294965248&e)?r=h(e>>6&31|192):0==(4294901760&e)?(o(e,t)||(e=65533),r=h(e>>12&15|224),r+=i(e,6)):0==(4292870144&e)&&(r=h(e>>18&7|240),r+=i(e,12),r+=i(e,6)),r+h(63&e|128)}function a(e,t){for(var n=!1!==(t=t||{}).strict,o=r(e),i=o.length,a=-1,c="";++a<i;)c+=s(o[a],n);return c}function c(){if(f>=l)throw Error("Invalid byte index");var e=255&p[f];if(f++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function d(e){var t,r;if(f>l)throw Error("Invalid byte index");if(f==l)return!1;if(t=255&p[f],f++,0==(128&t))return t;if(192==(224&t)){if((r=(31&t)<<6|c())>=128)return r;throw Error("Invalid continuation byte")}if(224==(240&t)){if((r=(15&t)<<12|c()<<6|c())>=2048)return o(r,e)?r:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(r=(7&t)<<18|c()<<12|c()<<6|c())>=65536&&r<=1114111)return r;throw Error("Invalid UTF-8 detected")}function u(e,t){var o=!1!==(t=t||{}).strict;p=r(e),l=p.length,f=0;for(var i,s=[];!1!==(i=d(o));)s.push(i);return n(s)}var p,l,f,h=String.fromCharCode;e.exports={version:"2.1.2",encode:a,decode:u}},function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),o=n.length,i="";for(r=0;r<o;r+=3)i+=e[n[r]>>2],i+=e[(3&n[r])<<4|n[r+1]>>4],i+=e[(15&n[r+1])<<2|n[r+2]>>6],i+=e[63&n[r+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,n,o,i,s,a=.75*e.length,c=e.length,d=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),p=new Uint8Array(u);for(t=0;t<c;t+=4)n=r[e.charCodeAt(t)],o=r[e.charCodeAt(t+1)],i=r[e.charCodeAt(t+2)],s=r[e.charCodeAt(t+3)],p[d++]=n<<2|o>>4,p[d++]=(15&o)<<4|i>>2,p[d++]=(3&i)<<6|63&s;return u}}()},function(e,t){function r(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var r=new Uint8Array(e.byteLength);r.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=r.buffer}return t}return e}))}function n(e,t){t=t||{};var n=new i;return r(e).forEach((function(e){n.append(e)})),t.type?n.getBlob(t.type):n.getBlob()}function o(e,t){return new Blob(r(e),t||{})}var i=void 0!==i?i:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,s=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),a=s&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),c=i&&i.prototype.append&&i.prototype.getBlob;"undefined"!=typeof Blob&&(n.prototype=Blob.prototype,o.prototype=Blob.prototype),e.exports=s?a?Blob:o:c?n:void 0},function(e,t){t.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},t.decode=function(e){for(var t={},r=e.split("&"),n=0,o=r.length;n<o;n++){var i=r[n].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},function(e,t){e.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){function r(e){var t="";do{t=s[e%a]+t,e=Math.floor(e/a)}while(e>0);return t}function n(e){var t=0;for(u=0;u<e.length;u++)t=t*a+c[e.charAt(u)];return t}function o(){var e=r(+new Date);return e!==i?(d=0,i=e):e+"."+r(d++)}for(var i,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,c={},d=0,u=0;u<a;u++)c[s[u]]=u;o.encode=r,o.decode=n,e.exports=o},function(e,t,r){(function(t){function n(){}function o(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{}}function i(e){if(s.call(this,e),this.query=this.query||{},!c){var t=o();c=t.___eio=t.___eio||[]}this.index=c.length;var r=this;c.push((function(e){r.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){r.script&&(r.script.onerror=n)}),!1)}var s=r(22),a=r(33);e.exports=i;var c,d=/\n/g,u=/\\n/g;a(i,s),i.prototype.supportsBinary=!1,i.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),s.prototype.doClose.call(this)},i.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},i.prototype.doWrite=function(e,t){function r(){n(),t()}function n(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(e){o.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+o.iframeId+'">';i=document.createElement(e)}catch(e){(i=document.createElement("iframe")).name=o.iframeId,i.src="javascript:0"}i.id=o.iframeId,o.form.appendChild(i),o.iframe=i}var o=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),n(),e=e.replace(u,"\\\n"),this.area.value=e.replace(d,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===o.iframe.readyState&&r()}:this.iframe.onload=r}}).call(t,function(){return this}())},function(e,t,r){function n(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=o&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(l=i),s.call(this,e)}var o,i,s=r(23),a=r(24),c=r(32),d=r(33),u=r(34),p=r(3)("engine.io-client:websocket");if("undefined"!=typeof WebSocket?o=WebSocket:"undefined"!=typeof self&&(o=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{i=r(37)}catch(e){}var l=o||i;e.exports=n,d(n,s),n.prototype.name="websocket",n.prototype.supportsBinary=!0,n.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new l(e,t):new l(e):new l(e,t,r)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},n.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},n.prototype.write=function(e){function t(){r.emit("flush"),setTimeout((function(){r.writable=!0,r.emit("drain")}),0)}var r=this;this.writable=!1;for(var n=e.length,o=0,i=n;o<i;o++)!function(e){a.encodePacket(e,r.supportsBinary,(function(o){if(!r.usingBrowserWebSocket){var i={};e.options&&(i.compress=e.options.compress),r.perMessageDeflate&&("string"==typeof o?Buffer.byteLength(o):o.length)<r.perMessageDeflate.threshold&&(i.compress=!1)}try{r.usingBrowserWebSocket?r.ws.send(o):r.ws.send(o,i)}catch(e){p("websocket closed before onclose event")}--n||t()}))}(e[o])},n.prototype.onClose=function(){s.prototype.onClose.call(this)},n.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},n.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=u()),this.supportsBinary||(e.b64=1),(e=c.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},n.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===n.prototype.name)}},function(e,t){},function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(e,t,r){function n(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}var o=r(7),i=r(11),s=r(40),a=r(41),c=r(42),d=r(3)("socket.io-client:socket"),u=r(32),p=r(26);e.exports=n;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=i.prototype.emit;i(n.prototype),n.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",c(this,"onopen")),a(e,"packet",c(this,"onpacket")),a(e,"close",c(this,"onclose"))]}},n.prototype.open=n.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},n.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},n.prototype.emit=function(e){if(l.hasOwnProperty(e))return f.apply(this,arguments),this;var t=s(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:p(t))?o.BINARY_EVENT:o.EVENT,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},n.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},n.prototype.onopen=function(){if(d("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?u.encode(this.query):this.query;d("sending connect packet with query %s",e),this.packet({type:o.CONNECT,query:e})}else this.packet({type:o.CONNECT})},n.prototype.onclose=function(e){d("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},n.prototype.onpacket=function(e){var t=e.nsp===this.nsp,r=e.type===o.ERROR&&"/"===e.nsp;if(t||r)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},n.prototype.onevent=function(e){var t=e.data||[];d("emitting event %j",t),null!=e.id&&(d("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?f.apply(this,t):this.receiveBuffer.push(t)},n.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var n=s(arguments);d("sending ack %j",n),t.packet({type:p(n)?o.BINARY_ACK:o.ACK,id:e,data:n})}}},n.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(d("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):d("bad ack %s",e.id)},n.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},n.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)f.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},n.prototype.ondisconnect=function(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},n.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},n.prototype.close=n.prototype.disconnect=function(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},n.prototype.compress=function(e){return this.flags.compress=e,this},n.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){function r(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}e.exports=r},function(e,t){function r(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}e.exports=r},function(e,t){var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}}])}));let a=!0,c=!0;function d(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function u(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,o=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return o.apply(this,arguments);const i=e=>{const t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,i),o.apply(this,[e,i])};const i=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(r))return i.apply(this,arguments);const n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function p(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function l(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(c=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function f(){if("object"==typeof window){if(a)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function h(e,t){c&&console.warn(e+" is deprecated, please use "+t+" instead.")}function m(e){return"[object Object]"===Object.prototype.toString.call(e)}function g(e){return m(e)?Object.keys(e).reduce((function(t,r){const n=m(e[r]),o=n?g(e[r]):e[r],i=n&&!Object.keys(o).length;return void 0===o||i?t:Object.assign(t,{[r]:o})}),{}):e}function v(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((n=>{n.endsWith("Id")?v(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((t=>{v(e,e.get(t),r)}))})))}function y(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;const i=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)})),i.forEach((t=>{e.forEach((r=>{r.type===n&&r.trackId===t.id&&v(e,r,o)}))})),o}const b=f;function C(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;const n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);const o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[o("min",r)]=n.ideal,t.optional.push(e),e={},e[o("max",r)]=n.ideal,t.optional.push(e)):(e[o("",r)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=n.exact):["min","max"].forEach((e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=n[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let i=e.video.facingMode;i=i&&("object"==typeof i?i:{ideal:i});const s=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===i.exact||"environment"===i.ideal?t=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then((r=>{let s=(r=r.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!s&&r.length&&t.includes("back")&&(s=r[r.length-1]),s&&(e.video.deviceId=i.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=n(e.video),b("chrome: "+JSON.stringify(e)),o(e)}))}e.video=n(e.video)}return b("chrome: "+JSON.stringify(e)),o(e)},i=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){o(e,(e=>{r.webkitGetUserMedia(e,t,(e=>{n&&n(i(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return o(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(i(e))))))}}}function w(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function S(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.track.id)):{track:r.track};const o=new Event("track");o.track=r.track,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)})),t.stream.getTracks().forEach((r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.id)):{track:r};const o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else u(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function k(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let o=r.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function T(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const o=function(e){const t={};return e.result().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{r[t]=e.stat(t)})),t[r.id]=r})),t},i=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const n=function(e){r(i(o(e)))};return t.apply(this,[n,e])}return new Promise(((e,r)=>{t.apply(this,[function(t){e(i(o(t)))},r])})).then(r,n)}}function R(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>y(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),u(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>y(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,n;return this.getSenders().forEach((r=>{r.track===e&&(t?n=!0:t=r)})),this.getReceivers().forEach((t=>(t.track===e&&(r?n=!0:r=t),t.track===e))),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function P(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();r.apply(this,arguments);const n=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),o.apply(this,arguments)}}function _(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return P(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}n.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function i(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(o.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const n=new e.MediaStream([t]);this._streams[r.id]=n,this._reverseStreams[n.id]=r,this.addStream(n)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[t=>{const r=i(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((e=>i(this,e)))}};e.RTCPeerConnection.prototype[t]=n[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:r})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:i(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((r=>{this._streams[r].getTracks().find((t=>e.track===t))&&(t=this._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function A(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}))}function x(e,t){u(e,"negotiationneeded",(e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var D=Object.freeze({__proto__:null,shimMediaStream:w,shimOnTrack:S,shimGetSendersWithDtmf:k,shimGetStats:T,shimSenderReceiverGetStats:R,shimAddTrackRemoveTrackWithNative:P,shimAddTrackRemoveTrack:_,shimPeerConnection:A,fixNegotiationNeeded:x,shimGetUserMedia:C,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((t=>{const n=r.video&&r.video.width,o=r.video&&r.video.height,i=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},n&&(r.video.mandatory.maxWidth=n),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function E(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){h("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function O(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function I(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,o,i]=arguments;return n.apply(this,[e||null]).then((e=>{if(t.version<53&&!o)try{e.forEach((e=>{e.type=r[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(o,i)}}function j(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function F(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),u(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function M(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){h("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function N(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function L(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const r=e.length>0;r&&e.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const n=t.apply(this,arguments);if(r){const{sender:t}=n,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(r).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return n})}function B(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function U(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var V=Object.freeze({__proto__:null,shimOnTrack:O,shimPeerConnection:I,shimSenderGetStats:j,shimReceiverGetStats:F,shimRemoveStream:M,shimRTCDataChannel:N,shimAddTransceiver:L,shimGetParameters:B,shimCreateOffer:U,shimCreateAnswer:q,shimGetUserMedia:E,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function z(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((r=>t.call(this,r,e))),e.getVideoTracks().forEach((r=>t.call(this,r,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach((e=>{r.includes(e.track)&&this.removeTrack(e)}))})}}function J(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}))}),t.apply(e,arguments)}}}function W(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};let a=function(e,t,r){const n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=a,a=function(e,t,r){const n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=a,a=function(e,t,r){const n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=a}function H(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(G(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function G(e){return e&&void 0!==e.video?Object.assign({},e,{video:g(e.video)}):e}function X(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let n=e.iceServers[r];void 0===n.urls&&n.url?(h("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function K(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Y(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function $(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Q=Object.freeze({__proto__:null,shimLocalStreamsAPI:z,shimRemoteStreamsAPI:J,shimCallbacksAPI:W,shimGetUserMedia:H,shimConstraints:G,shimRTCIceServerUrls:X,shimTrackEventTransceiver:K,shimCreateOfferLegacy:Y,shimAudioContext:$}),Z=i((function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){const r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((e=>0===e.indexOf(r)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const r={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":r.relatedAddress=t[e+1];break;case"rport":r.relatedPort=parseInt(t[e+1],10);break;case"tcptype":r.tcpType=t[e+1];break;case"ufrag":r.ufrag=t[e+1],r.usernameFragment=t[e+1];break;default:void 0===r[t[e]]&&(r[t[e]]=t[e+1])}return r},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let r;const n=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<n.length;e++)r=n[e].trim().split("="),t[r[0].trim()]=r[1];return t},t.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substring(t+1,n),r.value=e.substring(n+1)):r.attribute=e.substring(t+1),r},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){const n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],o=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&o?{usernameFragment:n.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" ");r.profile=n[2];for(let o=3;o<n.length;o++){const i=n[o],s=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){const n=t.parseRtpMap(s),o=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(n.parameters=o.length?t.parseFmtp(o[0]):{},n.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),r.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(n.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{r.headerExtensions.push(t.parseExtmap(e))}));const o=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach((e=>{o.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),r},t.writeRtpDescription=function(e,r){let n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));let o=0;return r.codecs.forEach((e=>{e.maxptime>o&&(o=e.maxptime)})),o>0&&(n+="a=maxptime:"+o+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach((e=>{n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){const r=[],n=t.parseRtpParameters(e),o=-1!==n.fecMechanisms.indexOf("RED"),i=-1!==n.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=s.length>0&&s[0].ssrc;let c;const d=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));d.length>0&&d[0].length>1&&d[0][0]===a&&(c=d[0][1]),n.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),r.push(t),o&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:i?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&a&&r.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,r.forEach((e=>{e.maxBitrate=u}))),r},t.parseRtcpParameters=function(e){const r={},n=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const o=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=0===o.length;const i=t.matchPrefix(e,"a=rtcp-mux");return r.mux=i.length>0,r},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let r;const n=t.matchPrefix(e,"a=msid:");if(1===n.length)return r=n[0].substring(7).split(" "),{stream:r[0],track:r[1]};const o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return o.length>0?(r=o[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(e){const r=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");let o;n.length>0&&(o=parseInt(n[0].substring(19),10)),isNaN(o)&&(o=65536);const i=t.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substring(12),10),protocol:r.fmt,maxMessageSize:o};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:o}}},t.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,r,n){let o;const i=void 0!==r?r:2;o=e||t.generateSessionId();return"v=0\r\no="+(n||"thisisadapterortc")+" "+o+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){const n=t.splitLines(e);for(let e=0;e<n.length;e++)switch(n[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[e].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const r=t.splitLines(e)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){const r=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const r=t.splitLines(e);for(let e=0;e<r.length;e++)if(r[e].length<2||"="!==r[e].charAt(1))return!1;return!0},e.exports=t})),ee=e({__proto__:null,default:Z},[Z]);function te(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const r=new t(e),n=Z.parseCandidate(e.candidate);for(const e in n)e in r||Object.defineProperty(r,e,{value:n[e]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,u(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function re(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||u(e,"icecandidate",(e=>{if(e.candidate){const t=Z.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function ne(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Z.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Z.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),r=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r}(e),n=function(e,r){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const o=Z.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?n=parseInt(o[0].substring(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n}(arguments[0],e);let o;o=0===r&&0===n?Number.POSITIVE_INFINITY:0===r||0===n?Math.max(r,n):Math.min(r,n);const i={};Object.defineProperty(i,"maxMessageSize",{get:()=>o}),this._sctp=i}return r.apply(this,arguments)}}function oe(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const n=arguments[0],o=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},u(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function ie(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function se(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const r=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ce(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return r.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>r.apply(this,[e])))})}var de=Object.freeze({__proto__:null,shimRTCIceCandidate:te,shimRTCIceCandidateRelayProtocol:re,shimMaxMessageSize:ne,shimSendThrowTypeError:oe,shimConnectionState:ie,removeExtmapAllowMixed:se,shimAddIceCandidateNullOrEmpty:ae,shimParameterlessSetLocalDescription:ce});const ue=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=f,n=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=d(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=d(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=d(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),o={browserDetails:n,commonShim:de,extractVersion:d,disableLog:p,disableWarnings:l,sdp:ee};switch(n.browser){case"chrome":if(!D||!A||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),o;if(null===n.version)return r("Chrome shim can not determine version, not shimming."),o;r("adapter.js shimming chrome."),o.browserShim=D,ae(e,n),ce(e),C(e,n),w(e),A(e,n),S(e),_(e,n),k(e),T(e),R(e),x(e,n),te(e),re(e),ie(e),ne(e,n),oe(e),se(e,n);break;case"firefox":if(!V||!I||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),o;r("adapter.js shimming firefox."),o.browserShim=V,ae(e,n),ce(e),E(e,n),I(e,n),O(e),M(e),j(e),F(e),N(e),L(e),B(e),U(e),q(e),te(e),ie(e),ne(e,n),oe(e);break;case"safari":if(!Q||!t.shimSafari)return r("Safari shim is not included in this adapter release."),o;r("adapter.js shimming safari."),o.browserShim=Q,ae(e,n),ce(e),X(e),Y(e),W(e),z(e),J(e),K(e),H(e),$(e),te(e),re(e),ne(e,n),oe(e),se(e,n);break;default:r("Unsupported browser!")}return o}({window:"undefined"==typeof window?void 0:window});var pe="2.0.0-beta.1";function le(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.join(" ");console.log(r)}function fe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.join(" ");console.error(r)}var he=function(){function e(e){this.baseURL=e}return e.prototype.send=function(e){var t=e.method||"GET",r="GET"===t,n=this.baseURL+e.path;return e.path.includes("http")&&(n=e.path),new Promise((function(o,i){var s=new XMLHttpRequest;s.responseType="json",s.onreadystatechange=function(){this.readyState===s.DONE&&(this.response?o(this.response):(window.webrtcFailedCallback&&window.webrtcFailedCallback(),i("错误的请求:".concat(n))))};var a=Object.entries(e.body).map((function(e){var t=e[0],r=e[1];return"&".concat(t,"=").concat(r)})).join("").replace("&",""),c=r?n+"?"+a:n,d=r?null:JSON.stringify(e.body);s.open(t.toLocaleLowerCase(),c,!0),s.setRequestHeader("Content-Type","application/json;charset=utf-8"),s.setRequestHeader("Accept","application/json;charset=utf-8"),e.Authorization&&s.setRequestHeader("Authorization",e.Authorization),s.send(d)}))},e}(),me=function(){function e(e){this.baseURL=e}return e.prototype.send=function(e){var t=e.method||"GET",r="GET"===t,n=(this.baseURL+e.path).substring(0,(this.baseURL+e.path).length-1),o=Object.assign({},e.body);return o.req_type||(o.req_type="0"),new Promise((function(i,s){var a=new XMLHttpRequest;a.responseType="json",a.onreadystatechange=function(){if(this.readyState===a.DONE)if(this.response){var e=this.response["C-Response-Body"]&&this.response["C-Response-Body"].Data_Enqr_Rslt;i(JSON.parse(e)||{})}else s("错误的请求:".concat(n))};var c=Object.entries(e.body).map((function(e){var t=e[0],r=e[1];return"&".concat(t,"=").concat(r)})).join("").replace("&",""),d=r?n+"?"+c:n,u=r?null:JSON.stringify({Data_Cntnt:JSON.stringify(o)});a.open(t.toLocaleLowerCase(),d,!0),a.setRequestHeader("Content-Type","application/json;charset=utf-8"),a.setRequestHeader("Accept","application/json;charset=utf-8"),a.send(u)}))},e}(),ge="http://10.208.53.5:31118",ve="TA238DH09",ye="TA238DH10",be="TA238DH11",Ce={asrOld:"/asr/",asr:"/asr/getResult/",login:"/user/auth/eaccess_token_login/",chat:"/api/v1/dmp/ttsa/chat/",interrupt:"/api/v1/dmp/ttsa/interrupt/",mute:"/api/v1/dmp/ttsa/mute/",ue4_config:"/api/v1/dmp/ttsa/ue4_config/",close:"/api/v1/dmp/ttsa/close/",open:"/api/v1/dmp/ttsa/open/",ttsa:"/api/v1/dmp/ttsa/ttsa/",action:"/api/v1/dmp/ttsa/auto_action/",predict:"/predict",registerC6:"/szr/business/register/",chatC6:"/szr/business/chat/",logoutC6:"/szr/business/logout/",asrC6:"/szr/asr/getResult/"},we=function(e,t){var r="";return"test"===e&&(r="/szr"),"".concat(r).concat(Ce[t])};ke.sessions={},ke.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||ke.extension.isInstalled()}return!0};var Se={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var r=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",r(n)}else r(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function ke(e){if((e=e||{}).success="function"==typeof e.success?e.success:ke.noop,e.error="function"==typeof e.error?e.error:ke.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:ke.noop,!ke.initDone)return e.error("Library not initialized"),{};if(!ke.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(ke.log("Library initialized: "+ke.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,r=null,n={},o=null,i=null,s=0,a=e.server;ke.isArray(a)?(ke.log("Multiple servers provided ("+a.length+"), will use the first that works"),a=null,i=e.server,ke.debug(i)):0===a.indexOf("ws")?(t=!0,ke.log("Using WebSockets to contact Janus: "+a)):(t=!1,ke.log("Using REST API to contact Janus: "+a));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],d=e.iceTransportPolicy,u=e.bundlePolicy,p=!0===e.ipv6,l=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(l=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var h=null;void 0!==e.token&&null!==e.token&&(h=e.token);var m=null;void 0!==e.apisecret&&null!==e.apisecret&&(m=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var v=6e4;function y(e){var t={high:9e5,medium:3e5,low:1e5};return null!=e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(v=e.longPollTimeout),isNaN(v)&&(v=6e4);var b,C=!1,w=null,S={},k=this,T=0,R={};function P(){if(null!=w)if(ke.debug("Long poll..."),C){var t=a+"/"+w+"?rid="+(new Date).getTime();f&&(t=t+"&maxev="+f),h&&(t=t+"&token="+encodeURIComponent(h)),m&&(t=t+"&apisecret="+encodeURIComponent(m)),ke.httpAPICall(t,{verb:"GET",withCredentials:l,success:_,timeout:v,error:function(t,r){if(ke.error(t+":",r),++T>3)return C=!1,void e.error("Lost connection to the server (is it down?)");P()}})}else ke.warn("Is the server down? (connected=false)")}function _(e,n){if(T=0,t||null==w||!0===n||P(),t||!ke.isArray(e))if("keepalive"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(c=e.sender))return void ke.warn("Missing sender...");if(!(u=S[c]))return void ke.debug("This handle is not attached to this session");var o=e.candidate;ke.debug("Got a trickled candidate on session "+w),ke.debug(o);var i=u.webrtcStuff;i.pc&&i.remoteSdp?(ke.debug("Adding remote candidate:",o),o&&!0!==o.completed?i.pc.addIceCandidate(o):i.pc.addIceCandidate(ke.endOfCandidates)):(ke.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),i.candidates||(i.candidates=[]),i.candidates.push(o),ke.debug(i.candidates))}else{if("webrtcup"===e.janus)return ke.debug("Got a webrtcup event on session "+w),ke.debug(e),(c=e.sender)?(u=S[c])?void u.webrtcState(!0):void ke.debug("This handle is not attached to this session"):void ke.warn("Missing sender...");if("hangup"===e.janus){if(ke.debug("Got a hangup event on session "+w),ke.debug(e),!(c=e.sender))return void ke.warn("Missing sender...");if(!(u=S[c]))return void ke.debug("This handle is not attached to this session");u.webrtcState(!1,e.reason),u.hangup()}else if("detached"===e.janus){if(ke.debug("Got a detached event on session "+w),ke.debug(e),!(c=e.sender))return void ke.warn("Missing sender...");if(!(u=S[c]))return;u.detached=!0,u.ondetached(),u.detach()}else if("media"===e.janus){if(ke.debug("Got a media event on session "+w),ke.debug(e),!(c=e.sender))return void ke.warn("Missing sender...");if(!(u=S[c]))return void ke.debug("This handle is not attached to this session");u.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(ke.debug("Got a slowlink event on session "+w),ke.debug(e),!(c=e.sender))return void ke.warn("Missing sender...");if(!(u=S[c]))return void ke.debug("This handle is not attached to this session");u.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var s,a;if(ke.error("Ooops: "+e.error.code+" "+e.error.reason),ke.debug(e),s=e.transaction)(a=R[s])&&a(e),delete R[s];return}if("event"===e.janus){var c;if(ke.debug("Got a plugin event on session "+w),ke.debug(e),!(c=e.sender))return void ke.warn("Missing sender...");var d=e.plugindata;if(!d)return void ke.warn("Missing plugindata...");ke.debug("  -- Event is coming from "+c+" ("+d.plugin+")");var u,p=d.data;if(ke.debug(p),!(u=S[c]))return void ke.warn("This handle is not attached to this session");var l=e.jsep;l&&(ke.debug("Handling SDP as well..."),ke.debug(l));var f=u.onmessage;f?(ke.debug("Notifying application..."),f(p,l)):ke.debug("No provided notification callback")}else{if("timeout"===e.janus)return ke.error("Timeout on session "+w),ke.debug(e),void(t&&r.close(3504,"Gateway timeout"));ke.warn("Unknown message/event  '"+e.janus+"' on session "+w),ke.debug(e)}}}else ke.debug("Got a success on session "+w),ke.debug(e),(s=e.transaction)&&((a=R[s])&&a(e),delete R[s]);else ke.debug("Got an ack on session "+w),ke.debug(e),(s=e.transaction)&&((a=R[s])&&a(e),delete R[s]);else ke.vdebug("Got a keepalive on session "+w);else for(var h=0;h<e.length;h++)_(e[h],!0)}function A(){if(a&&t&&C){o=setTimeout(A,g);var e={janus:"keepalive",session_id:w,transaction:ke.randomString(12)};h&&(e.token=h),m&&(e.apisecret=m),r.send(JSON.stringify(e))}}function x(c){var d=ke.randomString(12),u={janus:"create",transaction:d};if(c.reconnect&&(C=!1,u.janus="claim",u.session_id=w,r&&(r.onopen=null,r.onerror=null,r.onclose=null,o&&(clearTimeout(o),o=null))),h&&(u.token=h),m&&(u.apisecret=m),!a&&ke.isArray(i)&&(0===(a=i[s]).indexOf("ws")?(t=!0,ke.log("Server #"+(s+1)+": trying WebSockets to contact Janus ("+a+")")):(t=!1,ke.log("Server #"+(s+1)+": trying REST API to contact Janus ("+a+")"))),t)for(var p in r=ke.newWebSocket(a,"janus-protocol"),n={error:function(){if(ke.error("Error connecting to the Janus WebSockets server... "+a),ke.isArray(i)&&!c.reconnect)return++s===i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(a=null,void setTimeout((function(){x(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){R[d]=function(e){if(ke.debug(e),"success"!==e.janus)return ke.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);o=setTimeout(A,g),C=!0,w=e.session_id?e.session_id:e.data.id,c.reconnect?ke.log("Claimed session: "+w):ke.log("Created session: "+w),ke.sessions[w]=k,c.success()},r.send(JSON.stringify(u))},message:function(e){_(JSON.parse(e.data))},close:function(){a&&C&&(C=!1,e.error("Lost connection to the server (is it down?)"))}})r.addEventListener(p,n[p]);else ke.httpAPICall(a,{verb:"POST",withCredentials:l,body:u,success:function(e){if(ke.debug(e),"success"!==e.janus)return ke.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);C=!0,w=e.session_id?e.session_id:e.data.id,c.reconnect?ke.log("Claimed session: "+w):ke.log("Created session: "+w),ke.sessions[w]=k,P(),c.success()},error:function(e,t){if(ke.error(e+":",t),ke.isArray(i)&&!c.reconnect)return++s===i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(a=null,void setTimeout((function(){x(c)}),200));""===t?c.error(e+": Is the server down?"):c.error(e+": "+t)}})}function D(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:ke.noop,n.error="function"==typeof n.error?n.error:ke.noop,!C)return ke.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var o=S[e];if(!o||!o.webrtcStuff)return ke.warn("Invalid handle"),void n.error("Invalid handle");var i=n.message,s=n.jsep,c=ke.randomString(12),d={janus:"message",body:i,transaction:c};if(o.token&&(d.token=o.token),m&&(d.apisecret=m),s&&(d.jsep=s),ke.debug("Sending message to plugin (handle="+e+"):"),ke.debug(d),t)return d.session_id=w,d.handle_id=e,R[c]=function(e){if(ke.debug("Message sent!"),ke.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return ke.warn("Request succeeded, but missing plugindata..."),void n.success();ke.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return ke.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(ke.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(ke.error("Unknown error"),n.error("Unknown error"))},void r.send(JSON.stringify(d));ke.httpAPICall(a+"/"+w+"/"+e,{verb:"POST",withCredentials:l,body:d,success:function(e){if(ke.debug("Message sent!"),ke.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return ke.warn("Request succeeded, but missing plugindata..."),void n.success();ke.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return ke.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(ke.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(ke.error("Unknown error"),n.error("Unknown error"))},error:function(e,t){ke.error(e+":",t),n.error(e+": "+t)}})}function E(e,n){if(C){var o=S[e];if(o&&o.webrtcStuff){var i={janus:"trickle",candidate:n,transaction:ke.randomString(12)};if(o.token&&(i.token=o.token),m&&(i.apisecret=m),ke.vdebug("Sending trickle candidate (handle="+e+"):"),ke.vdebug(i),t)return i.session_id=w,i.handle_id=e,void r.send(JSON.stringify(i));ke.httpAPICall(a+"/"+w+"/"+e,{verb:"POST",withCredentials:l,body:i,success:function(e){ke.vdebug("Candidate sent!"),ke.vdebug(e),"ack"===e.janus||ke.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){ke.error(e+":",t)}})}else ke.warn("Invalid handle")}else ke.warn("Is the server down? (connected=false)")}function O(e){if(ke.statCallback){ke.statCheckId&&clearTimeout(ke.statCheckId);var t=window.frameInterval||1500;ke.statCheckId=setTimeout((function(){e.getStats().then((function(r){r.forEach((function(r){if(r&&"video"===r.kind&&"inbound-rtp"===r.type){if(console.log("lastPacketReceivedTimestamp:",r.lastPacketReceivedTimestamp),!b)return b=r.lastPacketReceivedTimestamp,void O(e);var n=r.lastPacketReceivedTimestamp-b<t;ke.statCallback(n),n?(b=r.lastPacketReceivedTimestamp,O(e)):clearTimeout(ke.statCheckId)}}))}))}),1e3)}}function I(e,t,r,n){var o=S[e];if(o&&o.webrtcStuff){var i=o.webrtcStuff,s=function(e){ke.log("Received state change on data channel:",e);var t=e.target.label,r=i.dataChannel[t]?i.dataChannel[t].readyState:"null";if(ke.log("State change on <"+t+"> data channel: "+r),"open"===r){if(O(i.pc),i.dataChannel[t].pending&&i.dataChannel[t].pending.length>0){for(var n of(ke.log("Sending pending messages on <"+t+">:",i.dataChannel[t].pending.length),i.dataChannel[t].pending))ke.log("Sending data on data channel <"+t+">"),ke.debug(n),i.dataChannel[t].send(n);i.dataChannel[t].pending=[]}o.ondataopen(t)}"close"===r&&clearTimeout(ke.statCheckId)};i.dataChannel[t]=r||i.pc.createDataChannel(t,{ordered:!0}),i.dataChannel[t].onmessage=function(e){ke.log("Received message on data channel:",e);var t=e.target.label;o.ondata(e.data,t)},i.dataChannel[t].onopen=s,i.dataChannel[t].onclose=s,i.dataChannel[t].onerror=function(e){ke.error("Got error on data channel:",e)},i.dataChannel[t].pending=[],n&&i.dataChannel[t].pending.push(n)}else ke.warn("Invalid handle")}function j(e,t){(t=t||{}).success="function"==typeof t.success?t.success:ke.noop,t.error="function"==typeof t.error?t.error:ke.noop;var r=S[e];if(!r||!r.webrtcStuff)return ke.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff,o=t.text||t.data;if(!o)return ke.warn("Invalid data"),void t.error("Invalid data");var i=t.label?t.label:ke.dataChanDefaultLabel;return n.dataChannel[i]?"open"!==n.dataChannel[i].readyState?(n.dataChannel[i].pending.push(o),void t.success()):(ke.log("Sending data on data channel <"+i+">"),ke.debug(o),n.dataChannel[i].send(o),void t.success()):(I(e,i,!1,o),void t.success())}function F(e,t){(t=t||{}).success="function"==typeof t.success?t.success:ke.noop,t.error="function"==typeof t.error?t.error:ke.noop;var r=S[e];if(!r||!r.webrtcStuff)return ke.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff;if(!n.dtmfSender){if(n.pc){var o=n.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!o)return ke.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=o.dtmf,n.dtmfSender&&(ke.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){ke.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return ke.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var i=t.dtmf;if(!i)return ke.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var s=i.tones;if(!s)return ke.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var a="number"==typeof i.duration?i.duration:500,c="number"==typeof i.gap?i.gap:50;ke.debug("Sending DTMF string "+s+" (duration "+a+"ms, gap "+c+"ms)"),n.dtmfSender.insertDTMF(s,a,c),t.success()}function M(e,n){(n=n||{}).success="function"==typeof n.success?n.success:ke.noop,n.error="function"==typeof n.error?n.error:ke.noop;var o=!0===n.noRequest;ke.log("Destroying handle "+e+" (only-locally="+o+")"),W(e);var i=S[e];if(!i||i.detached)return delete S[e],void n.success();if(o)return delete S[e],void n.success();if(!C)return ke.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var s={janus:"detach",transaction:ke.randomString(12)};if(i.token&&(s.token=i.token),m&&(s.apisecret=m),t)return s.session_id=w,s.handle_id=e,r.send(JSON.stringify(s)),delete S[e],void n.success();ke.httpAPICall(a+"/"+w+"/"+e,{verb:"POST",withCredentials:l,body:s,success:function(t){ke.log("Destroyed handle:"),ke.debug(t),"success"!==t.janus&&ke.error("Ooops: "+t.error.code+" "+t.error.reason),delete S[e],n.success()},error:function(t,r){ke.error(t+":",r),delete S[e],n.success()}})}function N(e,t,r,n,o){var i=S[e];if(!i||!i.webrtcStuff)return ke.warn("Invalid handle"),void n.error("Invalid handle");var s=i.webrtcStuff;ke.debug("streamsDone:",o),o&&(ke.debug("  -- Audio tracks:",o.getAudioTracks()),ke.debug("  -- Video tracks:",o.getVideoTracks()));var a=!1;if(s.myStream&&r.update&&!s.streamExternal){if((!r.update&&H(r)||r.update&&(r.addAudio||r.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(s.myStream.addTrack(o.getAudioTracks()[0]),ke.unifiedPlan){ke.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var l=null;if((h=s.pc.getTransceivers())&&h.length>0)for(var f of h)if(f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind){l=f;break}l&&l.sender?l.sender.replaceTrack(o.getAudioTracks()[0]):s.pc.addTrack(o.getAudioTracks()[0],o)}else ke.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),s.pc.addTrack(o.getAudioTracks()[0],o);if((!r.update&&X(r)||r.update&&(r.addVideo||r.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(s.myStream.addTrack(o.getVideoTracks()[0]),ke.unifiedPlan){ke.log((r.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var h,m=null;if((h=s.pc.getTransceivers())&&h.length>0)for(var f of h)if(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind){m=f;break}m&&m.sender?m.sender.replaceTrack(o.getVideoTracks()[0]):s.pc.addTrack(o.getVideoTracks()[0],o)}else ke.log((r.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),s.pc.addTrack(o.getVideoTracks()[0],o)}else s.myStream=o,a=!0;if(!s.pc){var g={iceServers:c,iceTransportPolicy:d,bundlePolicy:u};"chrome"===ke.webRTCAdapter.browserDetails.browser&&(g.sdpSemantics=ke.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var v={optional:[{DtlsSrtpKeyAgreement:!0}]};if(p&&v.optional.push({googIPv6:!0}),n.rtcConstraints&&"object"==typeof n.rtcConstraints)for(var b in ke.debug("Adding custom PeerConnection constraints:",n.rtcConstraints),n.rtcConstraints)v.optional.push(n.rtcConstraints[b]);"edge"===ke.webRTCAdapter.browserDetails.browser&&(g.bundlePolicy="max-bundle"),ke.log("Creating PeerConnection"),ke.debug(v),s.pc=new RTCPeerConnection(g,v),ke.debug(s.pc),s.pc.getStats&&(s.volume={},s.bitrate.value="0 kbits/sec"),ke.log("Preparing local SDP and gathering candidates (trickle="+s.trickle+")"),s.pc.oniceconnectionstatechange=function(e){s.pc&&i.iceState(s.pc.iceConnectionState)},s.pc.onicecandidate=function(t){if(!t.candidate||"edge"===ke.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)ke.log("End of candidates."),s.iceDone=!0,!0===s.trickle?E(e,{completed:!0}):function(e,t){t=t||{},t.success="function"==typeof t.success?t.success:ke.noop,t.error="function"==typeof t.error?t.error:ke.noop;var r=S[e];if(!r||!r.webrtcStuff)return void ke.warn("Invalid handle, not sending anything");var n=r.webrtcStuff;if(ke.log("Sending offer/answer SDP..."),!n.mySdp)return void ke.warn("Local SDP instance is invalid, not sending anything...");n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp.trickle=!1);ke.debug(t),n.sdpSent=!0,t.success(n.mySdp)}(e,n);else{var r={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===s.trickle&&E(e,r)}},s.pc.ontrack=function(e){ke.log("Handling Remote Track"),ke.debug(e),e.streams&&(s.remoteStream=e.streams[0],i.onremotestream(s.remoteStream),e.track.onended||ke.log("Adding onended callback to track:",e.track))}}if(a&&o){ke.log("Adding local stream");var C=!0===n.simulcast2;o.getTracks().forEach((function(e){if(ke.log("Adding local track:",e),C)if("audio"===e.kind)s.pc.addTrack(e,o);else{ke.log("Enabling rid-based simulcasting:",e);var t=y(n.simulcastMaxBitrates);s.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{rid:"h",active:!0,maxBitrate:t.high},{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:t.low,scaleResolutionDownBy:4}]})}else s.pc.addTrack(e,o)}))}(function(e){if(ke.debug("isDataEnabled:",e),"edge"===ke.webRTCAdapter.browserDetails.browser)return ke.warn("Edge doesn't support data channels yet"),!1;return null!=e&&!0===e.data})(r)&&!s.dataChannel[ke.dataChanDefaultLabel]&&(ke.log("Creating data channel"),I(e,ke.dataChanDefaultLabel,!1),s.pc.ondatachannel=function(t){ke.log("Data channel created by Janus:",t),I(e,t.channel.label,t.channel)}),s.myStream&&i.onlocalstream(s.myStream),t?s.pc.setRemoteDescription(t).then((function(){if(ke.log("Remote description accepted!"),s.remoteSdp=t.sdp,s.candidates&&s.candidates.length>0){for(var o=0;o<s.candidates.length;o++){var i=s.candidates[o];ke.debug("Adding remote candidate:",i),i&&!0!==i.completed?s.pc.addIceCandidate(i):s.pc.addIceCandidate(ke.endOfCandidates)}s.candidates=[]}!function(e,t,r){r=r||{},r.success="function"==typeof r.success?r.success:ke.noop,r.error="function"==typeof r.error?r.error:ke.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:ke.noop;var n=S[e];if(!n||!n.webrtcStuff)return ke.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff,i=!0===r.simulcast;i?ke.log("Creating answer (iceDone="+o.iceDone+", simulcast="+i+")"):ke.log("Creating answer (iceDone="+o.iceDone+")");var s=null;if(ke.unifiedPlan){s={};var a=null,c=null,d=o.pc.getTransceivers();if(d&&d.length>0)for(var u of d)u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?a||(a=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(c||(c=u));var p=H(t),l=G(t);if(p||l){if(p&&l){if(a)try{a.setDirection?a.setDirection("sendrecv"):a.direction="sendrecv",ke.log("Setting audio transceiver to sendrecv:",a)}catch(e){ke.error(e)}}else if(p&&!l)try{a&&(a.setDirection?a.setDirection("sendonly"):a.direction="sendonly",ke.log("Setting audio transceiver to sendonly:",a))}catch(e){ke.error(e)}else if(!p&&l)if(a)try{a.setDirection?a.setDirection("recvonly"):a.direction="recvonly",ke.log("Setting audio transceiver to recvonly:",a)}catch(e){ke.error(e)}else a=o.pc.addTransceiver("audio",{direction:"recvonly"}),ke.log("Adding recvonly audio transceiver:",a)}else if(t.removeAudio&&a)try{a.setDirection?a.setDirection("inactive"):a.direction="inactive",ke.log("Setting audio transceiver to inactive:",a)}catch(e){ke.error(e)}var f=X(t),h=K(t);if(f||h){if(f&&h){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",ke.log("Setting video transceiver to sendrecv:",c)}catch(e){ke.error(e)}}else if(f&&!h){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",ke.log("Setting video transceiver to sendonly:",c)}catch(e){ke.error(e)}}else if(!f&&h)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",ke.log("Setting video transceiver to recvonly:",c)}catch(e){ke.error(e)}else c=o.pc.addTransceiver("video",{direction:"recvonly"}),ke.log("Adding recvonly video transceiver:",c)}else if(t.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",ke.log("Setting video transceiver to inactive:",c)}catch(e){ke.error(e)}}else s="firefox"===ke.webRTCAdapter.browserDetails.browser||"edge"===ke.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:G(t),offerToReceiveVideo:K(t)}:{mandatory:{OfferToReceiveAudio:G(t),OfferToReceiveVideo:K(t)}};ke.debug(s);var m=X(t);if(m&&i&&"firefox"===ke.webRTCAdapter.browserDetails.browser){ke.log("Enabling Simulcasting for Firefox (RID)");var g=o.pc.getSenders()[1];ke.log(g);var v=g.getParameters();ke.log(v);var b=y(r.simulcastMaxBitrates);g.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:b.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:b.medium},{rid:"low",active:!0,priority:"low",maxBitrate:b.low}]})}o.pc.createAnswer(s).then((function(e){ke.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,ke.log("Setting local description"),m&&i&&("chrome"===ke.webRTCAdapter.browserDetails.browser?ke.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==ke.webRTCAdapter.browserDetails.browser&&ke.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(r.error),o.mediaConstraints=s,o.iceDone||o.trickle?r.success(e):ke.log("Waiting for all candidates...")}),r.error)}(e,r,n)}),n.error):function(e,t,r){r=r||{},r.success="function"==typeof r.success?r.success:ke.noop,r.error="function"==typeof r.error?r.error:ke.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:ke.noop;var n=S[e];if(!n||!n.webrtcStuff)return ke.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff,i=!0===r.simulcast;i?ke.log("Creating offer (iceDone="+o.iceDone+", simulcast="+i+")"):ke.log("Creating offer (iceDone="+o.iceDone+")");var s={};if(ke.unifiedPlan){var a=null,c=null,d=o.pc.getTransceivers();if(d&&d.length>0)for(var u of d)u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?a||(a=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(c||(c=u));var p=H(t),l=G(t);p||l?p&&l?a&&(a.setDirection?a.setDirection("sendrecv"):a.direction="sendrecv",ke.log("Setting audio transceiver to sendrecv:",a)):p&&!l?a&&(a.setDirection?a.setDirection("sendonly"):a.direction="sendonly",ke.log("Setting audio transceiver to sendonly:",a)):!p&&l&&(a?(a.setDirection?a.setDirection("recvonly"):a.direction="recvonly",ke.log("Setting audio transceiver to recvonly:",a)):(a=o.pc.addTransceiver("audio",{direction:"recvonly"}),ke.log("Adding recvonly audio transceiver:",a))):t.removeAudio&&a&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive",ke.log("Setting audio transceiver to inactive:",a));var f=X(t),h=K(t);f||h?f&&h?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",ke.log("Setting video transceiver to sendrecv:",c)):f&&!h?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",ke.log("Setting video transceiver to sendonly:",c)):!f&&h&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",ke.log("Setting video transceiver to recvonly:",c)):(c=o.pc.addTransceiver("video",{direction:"recvonly"}),ke.log("Adding recvonly video transceiver:",c))):t.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",ke.log("Setting video transceiver to inactive:",c))}else s.offerToReceiveAudio=G(t),s.offerToReceiveVideo=K(t);var m=!0===r.iceRestart;m&&(s.iceRestart=!0);ke.debug(s);var g=X(t);if(g&&i&&"firefox"===ke.webRTCAdapter.browserDetails.browser){ke.log("Enabling Simulcasting for Firefox (RID)");var v=o.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(v){var b=v.getParameters();b||(b={});var C=y(r.simulcastMaxBitrates);b.encodings=[{rid:"h",active:!0,maxBitrate:C.high},{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:C.low,scaleResolutionDownBy:4}],v.setParameters(b)}}o.pc.createOffer(s).then((function(e){ke.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,ke.log("Setting local description"),g&&i&&("chrome"===ke.webRTCAdapter.browserDetails.browser||"safari"===ke.webRTCAdapter.browserDetails.browser?(ke.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),r=!1,n=[-1],o=[-1],i=null,s=null,a=null,c=null,d=-1,u=0;u<t.length;u++){if(l=t[u].match(/m=(\w+) */)){if("video"===l[1]){if(!(n[0]<0)){d=u;break}r=!0}else if(n[0]>-1){d=u;break}}else if(r){var p=t[u].match(/a=ssrc-group:FID (\d+) (\d+)/);if(p)n[0]=p[1],o[0]=p[2],t.splice(u,1),u--;else{if(n[0]){if((h=t[u].match("a=ssrc:"+n[0]+" cname:(.+)"))&&(i=h[1]),(h=t[u].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(s=h[1]),(h=t[u].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(a=h[1]),(h=t[u].match("a=ssrc:"+n[0]+" label:(.+)"))&&(c=h[1]),0===t[u].indexOf("a=ssrc:"+o[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+n[0])){t.splice(u,1),u--;continue}}0!=t[u].length||(t.splice(u,1),u--)}}}if(n[0]<0){d=-1,r=!1;for(u=0;u<t.length;u++){var l;if(l=t[u].match(/m=(\w+) */)){if("video"===l[1]){if(!(n[0]<0)){d=u;break}r=!0}else if(n[0]>-1){d=u;break}}else if(r){if(n[0]<0){var f=t[u].match(/a=ssrc:(\d+)/);if(f){n[0]=f[1],t.splice(u,1),u--;continue}}else{var h;if((h=t[u].match("a=ssrc:"+n[0]+" cname:(.+)"))&&(i=h[1]),(h=t[u].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(s=h[1]),(h=t[u].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(a=h[1]),(h=t[u].match("a=ssrc:"+n[0]+" label:(.+)"))&&(c=h[1]),0===t[u].indexOf("a=ssrc:"+o[0])){t.splice(u,1),u--;continue}if(0===t[u].indexOf("a=ssrc:"+n[0])){t.splice(u,1),u--;continue}}0!==t[u].length||(t.splice(u,1),u--)}}}if(n[0]<0)return ke.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;d<0&&(d=t.length);n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(u=0;u<n.length;u++)i&&(t.splice(d,0,"a=ssrc:"+n[u]+" cname:"+i),d++),s&&(t.splice(d,0,"a=ssrc:"+n[u]+" msid:"+s),d++),a&&(t.splice(d,0,"a=ssrc:"+n[u]+" mslabel:"+a),d++),c&&(t.splice(d,0,"a=ssrc:"+n[u]+" label:"+c),d++),i&&(t.splice(d,0,"a=ssrc:"+o[u]+" cname:"+i),d++),s&&(t.splice(d,0,"a=ssrc:"+o[u]+" msid:"+s),d++),a&&(t.splice(d,0,"a=ssrc:"+o[u]+" mslabel:"+a),d++),c&&(t.splice(d,0,"a=ssrc:"+o[u]+" label:"+c),d++);t.splice(d,0,"a=ssrc-group:FID "+n[2]+" "+o[2]),t.splice(d,0,"a=ssrc-group:FID "+n[1]+" "+o[1]),t.splice(d,0,"a=ssrc-group:FID "+n[0]+" "+o[0]),t.splice(d,0,"a=ssrc-group:SIM "+n[0]+" "+n[1]+" "+n[2]),e=t.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==ke.webRTCAdapter.browserDetails.browser&&ke.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(r.error),o.mediaConstraints=s,o.iceDone||o.trickle?(ke.log("Offer ready"),ke.debug(r),r.success(e)):ke.log("Waiting for all candidates...")}),r.error)}(e,r,n)}function L(e,t,r){(r=r||{}).success="function"==typeof r.success?r.success:ke.noop,r.error="function"==typeof r.error?r.error:J;var n=r.jsep;if(t&&n)return ke.error("Provided a JSEP to a createOffer"),void r.error("Provided a JSEP to a createOffer");if(!(t||n&&n.type&&n.sdp))return ke.error("A valid JSEP is required for createAnswer"),void r.error("A valid JSEP is required for createAnswer");r.media="object"==typeof r.media&&r.media?r.media:{audio:!0,video:!0};var o=r.media,i=S[e];if(!i||!i.webrtcStuff)return ke.warn("Invalid handle"),void r.error("Invalid handle");var s,a=i.webrtcStuff;if(a.trickle=(s=r.trickle,ke.debug("isTrickleEnabled:",s),!!s),a.pc){if(ke.log("Updating existing media session"),o.update=!0,r.stream)r.stream!==a.myStream&&ke.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length)return ke.error("Can't add audio stream, there already is one"),void r.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(a.myStream&&a.myStream.getAudioTracks()&&0!==a.myStream.getAudioTracks().length?!H(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0):(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),H(o)&&(o.keepAudio=!1,o.addAudio=!0)),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length)return ke.error("Can't add video stream, there already is one"),void r.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);a.myStream&&a.myStream.getVideoTracks()&&0!==a.myStream.getVideoTracks().length?!X(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0):(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),X(o)&&(o.keepVideo=!1,o.addVideo=!0)),o.addData&&(o.data=!0)}if(H(o)&&o.keepAudio&&X(o)&&o.keepVideo)return i.consentDialog(!1),void N(e,n,o,r,a.myStream)}else o.update=!1,o.keepAudio=!1,o.keepVideo=!1;if(o.update&&!a.streamExternal){if(o.removeAudio||o.replaceAudio){if(a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length){var c=a.myStream.getAudioTracks()[0];ke.log("Removing audio track:",c),a.myStream.removeTrack(c);try{c.stop()}catch(A){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var d=!0;if(o.replaceAudio&&ke.unifiedPlan&&(d=!1),d)for(var u of a.pc.getSenders())u&&u.track&&"audio"===u.track.kind&&(ke.log("Removing audio sender:",u),a.pc.removeTrack(u))}}if(o.removeVideo||o.replaceVideo){if(a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length){var p=a.myStream.getVideoTracks()[0];ke.log("Removing video track:",p),a.myStream.removeTrack(p);try{p.stop()}catch(x){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var l=!0;if(o.replaceVideo&&ke.unifiedPlan&&(l=!1),l)for(var f of a.pc.getSenders())f&&f.track&&"video"===f.track.kind&&(ke.log("Removing video sender:",f),a.pc.removeTrack(f))}}}if(r.stream){var h=r.stream;if(ke.log("MediaStream provided by the application"),ke.debug(h),o.update&&a.myStream&&a.myStream!==r.stream&&!a.streamExternal){try{var m=a.myStream.getTracks();for(var g of m)ke.log(g),g&&g.stop()}catch(D){}a.myStream=null}return a.streamExternal=!0,i.consentDialog(!1),void N(e,n,o,r,h)}if(H(o)||X(o)){if(!ke.isGetUserMediaAvailable())return void r.error("getUserMedia not available");var v={mandatory:{},optional:[]};i.consentDialog(!0);var y=H(o);y&&o&&"object"==typeof o.audio&&(y=o.audio);var b=X(o);if(b&&o){var C=!0===r.simulcast,w=!0===r.simulcast2;if(!C&&!w||n||o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"==typeof o.video)b=o.video;else{var k=0,T=0;"lowres"===o.video?(T=240,k=320):"lowres-16:9"===o.video?(T=180,k=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(T=720,k=1280):"fhdres"===o.video?(T=1080,k=1920):"4kres"===o.video?(T=2160,k=3840):"stdres"===o.video?(T=480,k=640):"stdres-16:9"===o.video?(T=360,k=640):(ke.log("Default video setting is stdres 4:3"),T=480,k=640),ke.log("Adding media constraint:",o.video),b={height:{ideal:T},width:{ideal:k}},ke.log("Adding video constraint:",b)}else if("screen"===o.video||"window"===o.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return v.video={},o.screenshareFrameRate&&(v.video.frameRate=o.screenshareFrameRate),o.screenshareHeight&&(v.video.height=o.screenshareHeight),o.screenshareWidth&&(v.video.width=o.screenshareWidth),v.audio=o.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(v).then((function(t){i.consentDialog(!1),H(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){t.addTrack(i.getAudioTracks()[0]),N(e,n,o,r,t)})):N(e,n,o,r,t)}),(function(e){i.consentDialog(!1),r.error(e)}));function E(t,s){i.consentDialog(!1),t?r.error(t):N(e,n,o,r,s)}function O(e,t,r){ke.log("Adding media constraint (screen capture)"),ke.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){r?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(r){e.addTrack(r.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){i.consentDialog(!1),t(e)}))}if("chrome"===ke.webRTCAdapter.browserDetails.browser){var R=ke.webRTCAdapter.browserDetails.version,P=33;window.navigator.userAgent.match("Linux")&&(P=35),R>=26&&R<=P?O(v={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:H(o)&&!o.keepAudio},E):ke.extension.getScreen((function(e,t){if(e)return i.consentDialog(!1),r.error(e);(v={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,O(v,E,H(o)&&!o.keepAudio)}))}else if("firefox"===ke.webRTCAdapter.browserDetails.browser){if(!(ke.webRTCAdapter.browserDetails.version>=33)){var _=new Error("NavigatorUserMediaError");return _.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void r.error(_)}O(v={video:{mozMediaSource:o.video,mediaSource:o.video},audio:H(o)&&!o.keepAudio},(function(e,t){if(E(e,t),!e)var r=t.currentTime,n=window.setInterval((function(){t||window.clearInterval(n),t.currentTime==r&&(window.clearInterval(n),t.onended&&t.onended()),r=t.currentTime}),500)}))}return}}o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then((function(t){var s=t.some((function(e){return"audioinput"===e.kind})),a=function(e){if(ke.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!=typeof e.video||"object"!=typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(o)||t.some((function(e){return"videoinput"===e.kind})),c=H(o),d=X(o),u=function(e){return ke.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(o),p=function(e){return ke.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(o);if(c||d||u||p){var l=!!c&&s,f=!!d&&a;if(!l&&!f)return i.consentDialog(!1),r.error("No capture device found"),!1;if(!l&&u)return i.consentDialog(!1),r.error("Audio capture is required, but no capture device found"),!1;if(!f&&p)return i.consentDialog(!1),r.error("Video capture is required, but no capture device found"),!1}var m={audio:!(!s||o.keepAudio)&&y,video:!(!a||o.keepVideo)&&b};ke.debug("getUserMedia constraints",m),m.audio||m.video?navigator.mediaDevices.getUserMedia(m).then((function(t){i.consentDialog(!1),N(e,n,o,r,t)})).catch((function(e){i.consentDialog(!1),r.error({code:e.code,name:e.name,message:e.message})})):(i.consentDialog(!1),N(e,n,o,r,h))})).catch((function(e){i.consentDialog(!1),r.error("enumerateDevices error",e)}))}else N(e,n,o,r)}function B(e,t){(t=t||{}).success="function"==typeof t.success?t.success:ke.noop,t.error="function"==typeof t.error?t.error:J;var r=t.jsep,n=S[e];if(!n||!n.webrtcStuff)return ke.warn("Invalid handle"),void t.error("Invalid handle");var o=n.webrtcStuff;if(r){if(!o.pc)return ke.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(r).then((function(){if(ke.log("Remote description accepted!"),o.remoteSdp=r.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var n=o.candidates[e];ke.debug("Adding remote candidate:",n),n&&!0!==n.completed?o.pc.addIceCandidate(n):o.pc.addIceCandidate(ke.endOfCandidates)}o.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function U(e,t){var r=S[e];if(!r||!r.webrtcStuff)return ke.warn("Invalid handle"),0;var n=t?"remote":"local",o=r.webrtcStuff;return o.volume[n]||(o.volume[n]={value:0}),!o.pc.getStats||"chrome"!==ke.webRTCAdapter.browserDetails.browser&&"safari"!==ke.webRTCAdapter.browserDetails.browser?(ke.warn("Getting the "+n+" volume unsupported by browser"),0):t&&!o.remoteStream?(ke.warn("Remote stream unavailable"),0):t||o.myStream?o.volume[n].timer?o.volume[n].value:(ke.log("Starting "+n+" volume monitor"),o.volume[n].timer=setInterval((function(){o.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(o.volume[n].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(ke.warn("Local stream unavailable"),0)}function q(e,t){var r=S[e];if(!r||!r.webrtcStuff)return ke.warn("Invalid handle"),!0;var n=r.webrtcStuff;return n.pc?n.myStream?t?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?!n.myStream.getVideoTracks()[0].enabled:(ke.warn("No video track"),!0):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?!n.myStream.getAudioTracks()[0].enabled:(ke.warn("No audio track"),!0):(ke.warn("Invalid local MediaStream"),!0):(ke.warn("Invalid PeerConnection"),!0)}function V(e,t,r){var n=S[e];if(!n||!n.webrtcStuff)return ke.warn("Invalid handle"),!1;var o=n.webrtcStuff;return o.pc?o.myStream?t?o.myStream.getVideoTracks()&&0!==o.myStream.getVideoTracks().length?(o.myStream.getVideoTracks()[0].enabled=!r,!0):(ke.warn("No video track"),!1):o.myStream.getAudioTracks()&&0!==o.myStream.getAudioTracks().length?(o.myStream.getAudioTracks()[0].enabled=!r,!0):(ke.warn("No audio track"),!1):(ke.warn("Invalid local MediaStream"),!1):(ke.warn("Invalid PeerConnection"),!1)}function z(e){var t=S[e];if(!t||!t.webrtcStuff)return ke.warn("Invalid handle"),"Invalid handle";var r=t.webrtcStuff;return r.pc?r.pc.getStats?r.bitrate.timer?r.bitrate.value:(ke.log("Starting bitrate timer (via getStats)"),r.bitrate.timer=setInterval((function(){r.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(r.bitrate.bsnow=e.bytesReceived,r.bitrate.tsnow=e.timestamp,null===r.bitrate.bsbefore||null===r.bitrate.tsbefore)r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow;else{var n=r.bitrate.tsnow-r.bitrate.tsbefore;"safari"===ke.webRTCAdapter.browserDetails.browser&&(n/=1e3);var o=Math.round(8*(r.bitrate.bsnow-r.bitrate.bsbefore)/n);"safari"===ke.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),r.bitrate.value=o+" kbits/sec",r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(ke.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function J(e){ke.error("WebRTC error:",e)}function W(e,n){ke.log("Cleaning WebRTC stuff");var o=S[e];if(o){var i=o.webrtcStuff;if(i){if(!0===n){var s={janus:"hangup",transaction:ke.randomString(12)};o.token&&(s.token=o.token),m&&(s.apisecret=m),ke.debug("Sending hangup request (handle="+e+"):"),ke.debug(s),t?(s.session_id=w,s.handle_id=e,r.send(JSON.stringify(s))):ke.httpAPICall(a+"/"+w+"/"+e,{verb:"POST",withCredentials:l,body:s})}i.remoteStream=null,i.volume&&(i.volume.local&&i.volume.local.timer&&clearInterval(i.volume.local.timer),i.volume.remote&&i.volume.remote.timer&&clearInterval(i.volume.remote.timer)),i.volume={},i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null;try{if(!i.streamExternal&&i.myStream){ke.log("Stopping local stream tracks");var c=i.myStream.getTracks();for(var d of c)ke.log(d),d&&d.stop()}}catch(e){}i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(e){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null}o.oncleanup()}}function H(e){return ke.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function G(e){return ke.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function X(e){return ke.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function K(e){return ke.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}x(e),this.getServer=function(){return a},this.isConnected=function(){return C},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:ke.noop,e.error="function"==typeof e.error?e.error:ke.noop,e.reconnect=!0,x(e)},this.getSessionId=function(){return w},this.destroy=function(i){!function(i){clearTimeout(ke.statCheckId),i=i||{},i.success="function"==typeof i.success?i.success:ke.noop,i.error="function"==typeof i.error?i.error:ke.noop;var s=!0===i.unload,c=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(c=!0===i.notifyDestroyed);var d=!0===i.cleanupHandles;if(ke.log("Destroying session "+w+" (unload="+s+")"),!w)return ke.warn("No session to destroy"),i.success(),void(c&&e.destroyed());if(d)for(var u in S)M(u,{noRequest:!0});if(!C)return ke.warn("Is the server down? (connected=false)"),w=null,void i.success();var p={janus:"destroy",transaction:ke.randomString(12)};h&&(p.token=h);m&&(p.apisecret=m);if(s)return t?(r.onclose=null,r.close(),r=null):navigator.sendBeacon(a+"/"+w,JSON.stringify(p)),ke.log("Destroyed session:"),w=null,C=!1,i.success(),void(c&&e.destroyed());if(t){p.session_id=w;var f=function(){for(var e in n)r.removeEventListener(e,n[e]);r.removeEventListener("message",g),r.removeEventListener("error",v),o&&clearTimeout(o),r.close()},g=function(t){var r=JSON.parse(t.data);r.session_id==p.session_id&&r.transaction==p.transaction&&(f(),i.success(),c&&e.destroyed())},v=function(t){f(),i.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return r.addEventListener("message",g),r.addEventListener("error",v),void r.send(JSON.stringify(p))}ke.httpAPICall(a+"/"+w,{verb:"POST",withCredentials:l,body:p,success:function(t){ke.log("Destroyed session:"),ke.debug(t),w=null,C=!1,"success"!==t.janus&&ke.error("Ooops: "+t.error.code+" "+t.error.reason),i.success(),c&&e.destroyed()},error:function(t,r){ke.error(t+":",r),w=null,C=!1,i.success(),c&&e.destroyed()}})}(i)},this.attach=function(e){!function(e){if(e=e||{},e.success="function"==typeof e.success?e.success:ke.noop,e.error="function"==typeof e.error?e.error:ke.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:ke.noop,e.iceState="function"==typeof e.iceState?e.iceState:ke.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:ke.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:ke.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:ke.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:ke.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:ke.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:ke.noop,e.ondata="function"==typeof e.ondata?e.ondata:ke.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:ke.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:ke.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:ke.noop,!C)return ke.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return ke.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,i=e.token?e.token:h,s=ke.randomString(12),c={janus:"attach",plugin:n,opaque_id:o,transaction:s};i&&(c.token=i);m&&(c.apisecret=m);if(t)return R[s]=function(t){if(ke.debug(t),"success"!==t.janus)return ke.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;ke.log("Created handle: "+r);var o={session:k,plugin:n,id:r,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(){return U(r,!0)},getRemoteVolume:function(){return U(r,!0)},getLocalVolume:function(){return U(r,!1)},isAudioMuted:function(){return q(r,!1)},muteAudio:function(){return V(r,!1,!0)},unmuteAudio:function(){return V(r,!1,!1)},isVideoMuted:function(){return q(r,!0)},muteVideo:function(){return V(r,!0,!0)},unmuteVideo:function(){return V(r,!0,!1)},getBitrate:function(){return z(r)},send:function(e){D(r,e)},data:function(e){j(r,e)},dtmf:function(e){F(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){L(r,!0,e)},createAnswer:function(e){L(r,!1,e)},handleRemoteJsep:function(e){B(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){W(r,!0===e)},detach:function(e){M(r,e)}};S[r]=o,e.success(o)},c.session_id=w,void r.send(JSON.stringify(c));ke.httpAPICall(a+"/"+w,{verb:"POST",withCredentials:l,body:c,success:function(t){if(ke.debug(t),"success"!==t.janus)return ke.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;ke.log("Created handle: "+r);var o={session:k,plugin:n,id:r,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(){return U(r,!0)},getRemoteVolume:function(){return U(r,!0)},getLocalVolume:function(){return U(r,!1)},isAudioMuted:function(){return q(r,!1)},muteAudio:function(){return V(r,!1,!0)},unmuteAudio:function(){return V(r,!1,!1)},isVideoMuted:function(){return q(r,!0)},muteVideo:function(){return V(r,!0,!0)},unmuteVideo:function(){return V(r,!0,!1)},getBitrate:function(){return z(r)},send:function(e){D(r,e)},data:function(e){j(r,e)},dtmf:function(e){F(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){L(r,!0,e)},createAnswer:function(e){L(r,!1,e)},handleRemoteJsep:function(e){B(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){W(r,!0===e)},detach:function(e){M(r,e)}};S[r]=o,e.success(o)},error:function(t,r){ke.error(t+":",r),""===r?e.error(t+": Is the server down?"):e.error(t+": "+r)}})}(e)}}ke.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,r=e&&e.Promise||Promise,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},extension:e&&e.extension||Se,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,n){var o={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(o.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(o.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(o.body=JSON.stringify(n.body));var i=t(e,o).catch((function(e){return r.reject({message:"Probably a network error, is the server down?",error:e})}));if(n.timeout){var s=new r((function(e,t){var r=setTimeout((function(){return clearTimeout(r),t({message:"Request timed out",timeout:n.timeout})}),n.timeout)}));i=r.race([i,s])}return i.then((function(e){return e.ok?typeof n.success==typeof ke.noop?e.json().then((function(e){n.success(e)})).catch((function(t){return r.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:r.reject({message:"API call failed",response:e})})).catch((function(e){typeof n.error==typeof ke.noop&&n.error(e.message||"<< internal error >>",e)})),i}}},ke.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||Se,webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,r){var n=void 0!==r.body?{contentType:"application/json",data:JSON.stringify(r.body)}:{},o=void 0!==r.withCredentials?{xhrFields:{withCredentials:r.withCredentials}}:{};return t.ajax(t.extend(n,o,{url:e,type:r.verb,cache:!1,dataType:"json",async:r.async,timeout:r.timeout,success:function(e){typeof r.success==typeof ke.noop&&r.success(e)},error:function(e,t,n){typeof r.error==typeof ke.noop&&r.error(t,n)}}))}}},ke.noop=function(){},ke.dataChanDefaultLabel="JanusDataChannel",ke.endOfCandidates=null,ke.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:ke.noop,ke.statCallback=e.statCallback,ke.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),ke.trace=ke.noop,ke.debug=ke.noop,ke.vdebug=ke.noop,ke.log=ke.noop,ke.warn=ke.noop,ke.error=ke.noop,!0===e.debug||"all"===e.debug)ke.trace=console.trace.bind(console),ke.debug=console.debug.bind(console),ke.vdebug=console.debug.bind(console),ke.log=console.log.bind(console),ke.warn=console.warn.bind(console),ke.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var t of e.debug)switch(t){case"trace":ke.trace=console.trace.bind(console);break;case"debug":ke.debug=console.debug.bind(console);break;case"vdebug":ke.vdebug=console.debug.bind(console);break;case"log":ke.log=console.log.bind(console);break;case"warn":ke.warn=console.warn.bind(console);break;case"error":ke.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+t+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}ke.log("Initializing library");var r=e.dependencies||ke.useDefaultDependencies();ke.isArray=r.isArray,ke.webRTCAdapter=r.webRTCAdapter,ke.httpAPICall=r.httpAPICall,ke.newWebSocket=r.newWebSocket,ke.extension=r.extension,ke.extension.init(),ke.listDevices=function(e,t){e="function"==typeof e?e:ke.noop,null==t&&(t={audio:!0,video:!0}),ke.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(r){ke.debug(r),e(r);try{var n=t.getTracks();for(var o of n)o&&o.stop()}catch(e){}}))})).catch((function(t){ke.error(t),e([])})):(ke.warn("navigator.mediaDevices unavailable"),e([]))},ke.attachMediaStream=function(e,t){try{e.srcObject=t}catch(r){try{e.src=URL.createObjectURL(t)}catch(e){ke.error("Error attaching stream to element")}}},ke.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(r){try{e.src=t.src}catch(e){ke.error("Error reattaching stream to element")}}};var n=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",o=window["on"+n];if(window.addEventListener(n,(function(e){for(var t in ke.log("Closing window"),ke.sessions)ke.sessions[t]&&ke.sessions[t].destroyOnUnload&&(ke.log("Destroying session "+t),ke.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));o&&"function"==typeof o&&o()})),ke.safariVp8=!1,"safari"===ke.webRTCAdapter.browserDetails.browser&&ke.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var i of RTCRtpSender.getCapabilities("video").codecs)if(i&&i.mimeType&&"video/vp8"===i.mimeType.toLowerCase()){ke.safariVp8=!0;break}ke.safariVp8?ke.log("This version of Safari supports VP8"):ke.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var s=new RTCPeerConnection({});s.createOffer({offerToReceiveVideo:!0}).then((function(e){ke.safariVp8=-1!==e.sdp.indexOf("VP8"),ke.safariVp8?ke.log("This version of Safari supports VP8"):ke.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),s.close(),s=null}))}if(ke.unifiedPlan=!1,"firefox"===ke.webRTCAdapter.browserDetails.browser&&ke.webRTCAdapter.browserDetails.version>=59)ke.unifiedPlan=!0;else if("chrome"===ke.webRTCAdapter.browserDetails.browser&&ke.webRTCAdapter.browserDetails.version<72)ke.unifiedPlan=!1;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var a=new RTCPeerConnection;try{a.addTransceiver("audio"),ke.unifiedPlan=!0}catch(e){}a.close()}else ke.unifiedPlan=!1;ke.initDone=!0,e.callback()}},ke.isWebrtcSupported=function(){return!!window.RTCPeerConnection},ke.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},ke.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",n=0;n<e;n++){var o=Math.floor(62*Math.random());r+=t.substring(o,o+1)}return r};var Te=ke,Re=function(){function e(e){this.tag=":::[JanusClient]",this.videoEl=null,this.janus=null,this.opaqueId="videoroomtest"+Te.randomString(12),this.closed=!1,this.containerEl=e}return e.prototype.setup=function(e,t,r){var n=this;this.closed=!1,this.roomId=parseInt(e.room_id),this.pin=e.pin,this.server=e.janus_server_info,this.options=r;var o=(r||{}).janusServer;return le(this.tag,"【 ttsa options 】"),console.log(r),le(this.tag,"【 webrtc config 】"),console.log(e),new Promise((function(e,r){var i,s;n.resolve=e,n.reject=r,le(n.tag,"【 webrtc janus地址 】"),console.log(o||n.server),Te.init({debug:window.location.search.indexOf("janus=true")>-1,callback:function(){console.log("【 janus init 】"),n.janus=new Te({server:o||n.server,success:function(){console.log("Janus服务创建成功！"),n.attachVideoRoom()},error:function(e){le(n.tag,"create janus error",e),Te.error(e)},destroyed:function(){le(n.tag,"janus destroyed")}})},statCallback:t,params:{roomId:n.roomId,serverNode:(null===(s=null===(i=location.search)||void 0===i?void 0:i.split("serverNode")[1])||void 0===s?void 0:s.split("=")[1])||0}})}))},e.prototype.attachVideoRoom=function(){var e=this;this.janus?this.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:this.opaqueId,success:function(t){var r,n;Te.log("pluginHandle: ",t),e.sfutest=t,Te.log("Plugin attached! (".concat(null===(r=null==e?void 0:e.sfutest)||void 0===r?void 0:r.getPlugin(),",id=").concat(null===(n=null==e?void 0:e.sfutest)||void 0===n?void 0:n.getId(),")")),Te.log("  -- This is a publisher/manager"),e.registerUsername()},error:function(e){Te.error("  -- Error attaching plugin...",e)},onmessage:function(t,r){Te.debug(" ::: Got a message (publisher) :::",t);var n=t.videoroom;if(Te.debug("Event: "+n),n){if("joined"===n){if(e.myid=t.id,e.mypvtid=t.private_id,Te.log("Successfully joined room:".concat(t.room," with ID:").concat(e.myid)),t.publishers){var o=t.publishers;for(var i in Te.log("Got a list of available publishers/feeds:",o),o){var s=o[i].id,a=o[i].display,c=o[i].audio_codec,d=o[i].video_codec;Te.log("  >> [".concat(s,"] ").concat(a," (audio: ").concat(c,", video: ").concat(d,")")),null==e.remoteFeed&&e.newRemoteFeed(s,a,c,d)}}}else if("destroyed"===n)Te.warn("The room has been destroyed!");else if("event"===n)if(t.publishers){o=t.publishers;for(var i in Te.log("Got a list of available publishers/feeds:",o),o){s=o[i].id,a=o[i].display,c=o[i].audio_codec,d=o[i].video_codec;Te.log("  >> [".concat(s,"] ").concat(a," (audio: ").concat(c,", video: ").concat(d,")")),null==e.remoteFeed&&e.newRemoteFeed(s,a,c,d)}}else if(t.leaving){var u=t.leaving;Te.log("Publisher left: "+u)}else if(t.unpublished){var p=t.unpublished;if(Te.log("Publisher left: "+p),"ok"===p&&e.sfutest)return void e.sfutest.hangup()}else t.error&&(426===t.error_code?le(e.tag,"<p>Apparently room <code>".concat(e.roomId,"</code> (the one this demo uses as a test room) does not exist...</p><p>Do you have an updated <code>janus.plugin.videoroom.jcfg</code> configuration file? If not, make sure you copy the details of room <code>").concat(e.roomId,"</code> from that sample in your current configuration file, then restart Janus and try again.")):le(t.error))}else e.reject("invalid event")}}):le(this.tag,"invalid janus instance")},e.prototype.registerUsername=function(){var e,t,r=null===(t=!1!==(null===(e=this.options)||void 0===e?void 0:e.config.video))||void 0===t||t,n=Te.randomString(5);Te.log("username:".concat(n));var o={request:"join",room:this.roomId,pin:this.pin,ptype:"publisher",display:n,offer_video:r};this.sfutest&&this.sfutest.send({message:o})},e.prototype.newRemoteFeed=function(e,t,r,i){var s=this,a=this;this.janus?this.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:this.opaqueId,success:function(t){return n(s,void 0,void 0,(function(){var r,n,i,s;return o(this,(function(o){switch(o.label){case 0:return r=null===(s=!1!==(null===(i=a.options)||void 0===i?void 0:i.config.video))||void 0===s||s,this.remoteFeed=t,Te.log("Plugin attached! (".concat(this.remoteFeed.getPlugin(),", id=").concat(this.remoteFeed.getId(),")")),Te.log("  -- This is a subscriber"),n={request:"join",room:this.roomId,pin:this.pin,ptype:"subscriber",feed:e,private_id:this.mypvtid,offer_video:r},this.remoteFeed?[4,this.remoteFeed.send({message:n})]:[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}}))}))},error:function(e){Te.error("  -- Error attaching plugin...",e)},onmessage:function(e,t){var r;Te.log(" ::: Got a message (subscriber) :::",e);var n=e.videoroom;if(Te.debug("Event: ".concat(n)),e.error)le(e.error);else if(n&&"attached"===n){s.rfindex=1;var o=e.id,i=e.display;Te.log("Successfully attached to feed ".concat(o," (").concat(i,") in room ").concat(e.room))}t&&(Te.log("Handling SDP as well...",t),null===(r=s.remoteFeed)||void 0===r||r.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){Te.debug("Got SDP!",e);var t={request:"start",room:s.roomId};s.remoteFeed&&s.remoteFeed.send({message:t,jsep:e})},error:function(e){Te.error("WebRTC error:",e),le("WebRTC error... ".concat(e.message))}}))},iceState:function(e){var t,r="ICE state of this WebRTC PeerConnection (feed #".concat(s.rfindex,") changed to ").concat(e);Te.log(r),"disconnected"!==e||s.closed||null===(t=null==s?void 0:s.options)||void 0===t||t.errorCallback("数字人链接已断开","webrtcState_error")},webrtcState:function(e){Te.log("Janus says this WebRTC PeerConnection (feed #"+s.rfindex+") is "+(e?"up":"down")+" now")},onremotestream:function(e){var t,r,n=null===(r=!1!==(null===(t=a.options)||void 0===t?void 0:t.config.video))||void 0===r||r;if(s.closed)Te.debug("closed()");else if(Te.debug("Remote feed #"+s.rfindex+", stream:",e),0===s.containerEl.querySelectorAll("video").length){var o="display:".concat(n?"block":"none",";width:100%;height:100%;"),i=document.createElement("video");i.setAttribute("style",o),i.setAttribute("autoplay","true"),i.setAttribute("playsinline","true"),i.setAttribute("webkit-playsinline","true"),i.setAttribute("id","ttsa-video"),i.setAttribute("x5-playsinline","true"),i.setAttribute("controls","true"),i.addEventListener("click",(function(e){e.stopPropagation(),i.play()})),Te.attachMediaStream(i,e),Te.log("Streaming attached"),i.onloadeddata=function(){window.__onVideoLoadedDataTime=(new Date).valueOf(),le("加载时间：".concat((window.__onVideoLoadedDataTime-window.__setupTime)/1e3,"s")),setTimeout((function(){var e;(null===(e=a.options)||void 0===e?void 0:e.onVideoLoadedData)&&a.options.onVideoLoadedData(),i.removeAttribute("controls")}),0)},s.containerEl.appendChild(i),s.videoEl=i,s.resolve()}},ondata:function(e,t){Te.log("receive data: ".concat(e,", label: ").concat(t))},oncleanup:function(){Te.log(" ::: Got a cleanup notification (remote feed ".concat(e,") :::")),s.remoteFeed=void 0}}):le(this.tag,"invalid janus instance")},e.prototype.leaveRoom=function(){this.remoteFeed&&(this.remoteFeed.send({message:{request:"leave"}}),this.remoteFeed.send({message:{request:"destroy"}}),this.remoteFeed=void 0),this.janus&&this.janus.destroy(),this.videoEl&&this.containerEl.removeChild(this.videoEl),this.closed=!0},e}(),Pe=function(e){var t=Object.assign(e,{req_type:e.req_type||"0"});return JSON.stringify(t).replace(/\"|\'/g,'"')},_e=function(e){var t=this;this.eventName={success:[],error:[]},this._ajax=null,this._isTest=!1,this.then=function(e){if(e)return t.eventName.success=[e],t},this.catch=function(e){if(e)return t.eventName.error=[e],t},this.post=function(e){var r=t,n=e.code,o=e.data,i=e.maskAll,s=void 0!==i&&i;return setTimeout((function(){console.log("【【 请求参数 】】"),console.log(JSON.stringify({Data_Cntnt:Pe(o)})),t._ajax({url:"/ecpweb/ecpJson.action",safe:!0,maskAll:s,data:{_fw_service_id:"simpleTransaction",transaction_id:n,jsonData:JSON.stringify({Data_Cntnt:Pe(o)}),jsonClass:"java.util.Map"},success:function(e,t){if(console.log("【【 返回参数 】】"),console.log(e),"00"===(null==e?void 0:e.BK_STATUS)){var n=JSON.parse(null==e?void 0:e.Data_Enqr_Rslt),o=r.eventName.success;(o||o.length)&&o[0](n,t)}},error:function(e,t){var n=r.eventName.error;(n||n.length)&&n[0](e,t)}})})),t};var r=e.ajax;this._ajax=r};window.adapter=ue;var Ae=pe,xe=function(){function e(e){var t=this;this.tag="[FTC TTSA SDK v".concat(Ae,"]"),this.ajax=null,this.ajaxPromise=null,this.token=null,this.bizType=null,this.room=null,this.widgetCallback=function(e){return console.log(t.tag,e)},this.errorCallback=function(e){return console.log(t.tag,e)},this.widgetSocket=null,this.voiceQueue={start:0,end:0};var r=e.width,n=e.height,o=e.widgetCallback,i=e.webrtcCallback,s=e.errorCallback;this.widgetCallback=o,this.errorCallback=s,this.webrtcCallback=i;var a=document.querySelector(e.container);a||fe(this.tag,"错误的容器标识：",e.container),a.style.width="".concat(r,"px"),a.style.height="".concat(n,"px"),this.containerEl=a,this.voiceQueue={start:0,end:0},this.options=e,"test"===e.bizMode?this.http=new me(e.server||ge):this.http=new he(e.server||ge),e.ajax&&(this.ajax=e.ajax,this.ajaxPromise=new _e({ajax:e.ajax}))}return e.prototype.setup=function(e){var t=this,i=this;return e?(i.options.account=e,window.__setupTime=(new Date).valueOf(),this.openRoom().then((function(e){t.room=r(r({},e),{room_id:+location.search.split("roomid=")[1]||e.room_id});var n,o=(n=t.containerEl,new Re(n));return t.webrtcClient=o,o.setup(t.room,t.webrtcCallback,i.options)})).then((function(){return n(t,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.setupWidgetSocket()];case 1:return e.sent(),[2]}}))}))})).catch((function(e){return t.errorCallback&&t.errorCallback(e,"open_error"),fe(t.tag,JSON.stringify(e)),Promise.reject(e)}))):(fe(this.tag,"缺少登陆信息"),Promise.reject("缺少登陆信息"))},e.prototype.openRoom=function(){return n(this,void 0,void 0,(function(){var e,t=this;return o(this,(function(r){return e=this,this.options.account?[2,this.closeRoom().then((function(){return e.loginAccount()})).then((function(e){return t.token=e,t.openAccount()})).catch((function(e){t.errorCallback&&t.errorCallback(e,"open_error"),console.log(e)}))]:[2]}))}))},e.prototype.getSecretId=function(){return this.options.config.secret_id?(console.warn(this.tag,"config.secret_id 在下个版本即将弃用，请使用 account.role_id"),this.options.config.secret_id):this.options.account.role_id?this.options.account.role_id:(fe(this.tag,"无效的 role_id"),"")},e.prototype.loginAccount=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,i,s;return o(this,(function(o){switch(o.label){case 0:return e=this.options.account,t=e.username,r=e.app_id,n=e.now_time,i=e.access_token,[4,this.http.send({method:"POST",path:we(this.options.bizMode,"login"),body:{username:t,app_id:r,access_token:i,ts:n}})];case 1:return(s=o.sent()).error_code?(this.errorCallback&&this.errorCallback(s.error_reason,"login_error"),fe(this.tag,"login() error: 登陆鉴权失败"),[2,Promise.reject(s)]):[2,s]}}))}))},e.prototype.openAccount=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,i,s,a,c,d,u,p;return o(this,(function(o){switch(o.label){case 0:return this.token?(le(this.tag,"open()"),e=this.getSecretId(),t=this.token,r=t.user_id,n=t.key,i=this.options,s=i.config,a=i.width,c=i.height,a&&c&&(d="".concat(a,"x").concat(c)),u=Object.assign({user_id:r,key:n,secret_id:e,resolution:d,room_type:"janus"},s),[4,this.http.send({method:"POST",path:we(this.options.bizMode,"open"),body:u})]):[2,Promise.reject("未登录")];case 1:return(p=o.sent()).error_code?(fe(this.tag,p.error_reason),[2,Promise.reject(p)]):[2,p.data]}}))}))},e.prototype.sendText=function(e,t){var r;return n(this,void 0,void 0,(function(){var n,i,s,a,c,d,u,p,l,f,h=this;return o(this,(function(o){switch(o.label){case 0:return this.token?e?(le(this.tag,"sendText()"),n=this.getSecretId(),i=this.token,s=i.user_id,a=i.key,c=e,(null==t?void 0:t.xml)&&(d=/<[^>]*>/g,c=e.replace(d,"")),u=/&nbsp;|<br>|<br \/>|<HTML>|<\/HTML>/g,c=c.replace(u,"，"),p=/(《|》|:|：|——)/g,c=c.replace(p,"$1，"),(null===(r=null==t?void 0:t.type)||void 0===r?void 0:r.includes("autoAction"))?[4,this.autoAction(c)]:[3,2]):[2]:(fe(this.tag,"未登录"),[2]);case 1:l=o.sent(),c=l.data||c,o.label=2;case 2:return c=function(e){var t=e;return(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/1\.(?!\d)/g,"一，")).replace(/2\.(?!\d)/g,"二，")).replace(/3\.(?!\d)/g,"三，")).replace(/4\.(?!\d)/g,"四，")).replace(/5\.(?!\d)/g,"五，")).replace(/6\.(?!\d)/g,"六，")).replace(/7\.(?!\d)/g,"七，")).replace(/8\.(?!\d)/g,"八，")).replace(/9\.(?!\d)/g,"九，")}(c),f={async:!0,interrupt:!0,user_id:s,key:a,secret_id:n,query_text:"ttsa",text:c},[2,this.http.send({method:"POST",path:we(this.options.bizMode,"ttsa"),body:f}).then((function(e){e.error_code&&(h.errorCallback&&h.errorCallback(e.error_reason,"sendText_error"),fe(h.tag,"sendText() error:",e.error_reason))})).catch((function(e){h.errorCallback&&h.errorCallback(e),le(h.tag,JSON.stringify(e))}))]}}))}))},e.prototype.chat=function(e){return n(this,void 0,void 0,(function(){var t,n,i,s,a,c,d,u=this;return o(this,(function(o){return t=this,this.token?(n="string"==typeof e?{query_text:e}:r({auto_action:this.options.config.auto_action},e),i=this.getSecretId(),s=this.token,a=s.user_id,c=s.key,d=r({async:!0,interrupt:!0,user_id:a,key:c,secret_id:i},n),[2,this.http.send({method:"POST",path:we(this.options.bizMode,"chat"),body:d}).then((function(e){return t.widgetCallback({callback_info:{data:e.data,type:"voice_chat_data"}}),e.error_code&&(u.errorCallback&&u.errorCallback(e.error_reason,"chat_error"),fe(u.tag,"chat() error:",e.error_reason)),e})).catch((function(e){u.errorCallback&&u.errorCallback(e),le(u.tag,JSON.stringify(e))}))]):(fe(this.tag,"未登录"),[2])}))}))},e.prototype.interrupt=function(){return n(this,void 0,void 0,(function(){var e,t,r,n=this;return o(this,(function(o){return this.token?(e=this.token,t=e.user_id,r=e.key,[2,this.http.send({method:"POST",path:we(this.options.bizMode,"interrupt"),body:{user_id:t,key:r}}).then((function(e){e.error_code&&(n.errorCallback&&n.errorCallback(e.error_reason,"interrupt_error"),fe(n.tag,"interrupt() error:",e.error_reason))})).catch((function(e){le(n.tag,JSON.stringify(e))}))]):(fe(this.tag,"未登录"),[2])}))}))},e.prototype.mute=function(e){return n(this,void 0,void 0,(function(){var t,r,n,i,s=this;return o(this,(function(o){return this.token?(le(this.tag,"mute()"),t=this.token,r=t.user_id,n=t.key,i={mute:e?"1":"0",user_id:r,key:n},[2,this.http.send({method:"POST",path:we(this.options.bizMode,"mute"),body:i}).then((function(e){e.error_code&&(s.errorCallback&&s.errorCallback(e.error_reason,"mute_error"),fe(s.tag,"mute() error:",e.error_reason))})).catch((function(e){s.errorCallback&&s.errorCallback(e),le(s.tag,JSON.stringify(e))}))]):(fe(this.tag,"未登录"),[2])}))}))},e.prototype.roomConfig=function(e){return n(this,void 0,void 0,(function(){var t,n,i,s,a,c,d,u,p,l=this;return o(this,(function(o){switch(o.label){case 0:return this.token?(t=this.getSecretId(),n=this.token,i=n.user_id,s=n.key,a=r({video:!0},e),console.log("defaultConfig"),console.log(a),c=r({user_id:i,key:s,secret_id:t},a),d={request:"configure",audio:!0,video:a.video,data:!0},u=this.containerEl.querySelector("#ttsa-video"),p="display:".concat(a.video?"block":"none",";width:100%;height:100%;"),[4,this.webrtcClient.remoteFeed.send({message:d})]):(fe(this.tag,"未登录"),[2]);case 1:return o.sent(),null==u||u.setAttribute("style",p),[2,this.http.send({method:"POST",path:we(this.options.bizMode,"ue4_config"),body:c}).then((function(e){e.error_code&&(l.errorCallback&&l.errorCallback(e.error_reason,"roomConfig_error"),fe(l.tag,"roomConfig() error:",e.error_reason))})).catch((function(e){l.errorCallback&&l.errorCallback(e),le(l.tag,JSON.stringify(e))}))]}}))}))},e.prototype.closeRoom=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,i=this;return o(this,(function(o){return this.token&&this.room?(le(this.tag,"closeRoom()"),e=this.token,t=e.user_id,r=e.key,n=this.room.room_id,this.widgetSocket&&this.widgetSocket.close(),this.webrtcClient&&this.webrtcClient.leaveRoom(),[2,this.http.send({method:"POST",path:we(this.options.bizMode,"close"),body:{user_id:t,key:r,room_id:n}}).then((function(e){e.error_code&&(i.errorCallback&&i.errorCallback(e.error_reason,"closeRoom_error"),fe(i.tag,"closeRoom() error:",e.error_reason)),i.token=null,i.room=null}))]):[2,Promise.resolve()]}))}))},e.prototype.autoAction=function(e){return n(this,void 0,void 0,(function(){var t,r,n,i;return o(this,(function(o){return this.token?(le(this.tag,"autoAction()"),t=this.token,r=t.user_id,n=t.key,i={text:e,digital_id:1,insert_arm_action:!0,keep_existent_arm_action:!0,insert_head_action:!1,keep_existent_head_action:!1},[2,this.http.send({method:"POST",path:we(this.options.bizMode,"action"),body:i,Authorization:"token ".concat(r," ").concat(n)}).then((function(e){return e}))]):[2,Promise.resolve()]}))}))},e.prototype.pause=function(e){return n(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return this.token?(le(this.tag,"pause()"),e={request:"configure",audio:!0,video:!1,data:!0},[4,this.webrtcClient.remoteFeed.send({message:e})]):[2,Promise.resolve()];case 1:return[2,t.sent()]}}))}))},e.prototype.setupWidgetSocket=function(){var e=this;return new Promise((function(t,n){if(!e.token||!e.room)return n({error_reason:"无效的登录信息"});var o=":::[UICallback]",i=e.token.user_id,a=e.room.app_server_info,c=e.options.appServer;e.widgetSocket=s(c||a),e.widgetSocket&&(e.widgetSocket.on("connect",(function(){if(le(o,"".concat(c||a," connected")),e.widgetSocket&&e.token){var r={user_id:i,session_id:e.token.session_id};e.widgetSocket.emit("session_info",r),t(!0)}})),e.widgetSocket.on("ui_callback",(function(t){var n=t.callback_info||{},o=0;"voice_end"===n.type?(o=e.voiceQueue.start,e.voiceQueue.start++):"voice_start"===n.type&&(o=e.voiceQueue.end,e.voiceQueue.end++),e.widgetCallback(r(r({},t),{id:o,callback_info:r({},n)}))})),e.widgetSocket.on("error",(function(e){fe(o,e)})),e.widgetSocket.on("connect_error",(function(t){e.errorCallback&&e.errorCallback(t,"widgetSocket_error"),fe(o,t)})),e.widgetSocket.on("disconnect",(function(t){fe(o,"disconnect:",t),e.widgetSocket=null})))}))},e}();console.log("[FTC TTSA SDK v".concat(Ae,"] loaded")),window.FTC_TTSA_PRIM=xe;var De=function(e){function i(t){var r=e.call(this,t)||this;return r.sessionId="",r}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}(i,e),i.prototype.env=function(e,t){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){return o(this,(function(r){return Object.assign(e,{req_type:"1"}),le(this.tag,"env获取环境："),t&&t(e.config),[2]}))}))},i.prototype.register=function(e,t){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){var r,n,i,s=this;return o(this,(function(o){return r=this,this.bizType="0",n=Object.assign(e,{req_type:"1"}),this.ajax?(le(this.tag,"register()"),i=this.ajaxPromise.post({code:ve,data:n,maskAll:!1}),setTimeout((function(){i.then((function(e){le(s.tag,"ECP注册接口请求成功 then()"),console.log(e),(null==e?void 0:e.Ssn_ID)&&(s.sessionId=null==e?void 0:e.Ssn_ID,t&&t(e),r.sendText(null==e?void 0:e.Cnvs_Cntnt))}))})),[2,i]):[2]}))}))},i.prototype.registerC6=function(e){return n(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){return[2,this.http.send({method:"POST",path:Ce.registerC6,body:r({req_type:"1"},e)}).then((function(e){return console.log(e),e&&e.Ssn_ID})).catch((function(e){le(t.tag,JSON.stringify(e))}))]}))}))},i.prototype.chatC6=function(e){return n(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){return[2,this.http.send({method:"POST",path:Ce.chatC6,body:r({req_type:"1"},e)}).then((function(e){return console.log(e),e})).catch((function(e){le(t.tag,JSON.stringify(e))}))]}))}))},i.prototype.asrC6=function(e){return n(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){return[2,this.http.send({method:"POST",path:Ce.asrC6,body:r({req_type:"1"},e)}).then((function(e){return console.log("asr=========="),console.log(e),e})).catch((function(e){le(t.tag,JSON.stringify(e))}))]}))}))},i.prototype.chatECP=function(e,t){return n(this,void 0,void 0,(function(){var i,s,a,c,d,u=this;return o(this,(function(p){i=this;try{this.getSecretId(),s=this.token,s.user_id,s.key}catch(e){}return a=Object.assign(e,{req_type:"1"}),c=r(r({},a),{role_id:"test",token:"test",user_id:123456,ttsa_type:1}),this.ajax?(le(this.tag,"chatECP()"),d=this.ajaxPromise.post({code:ye,data:c,maskAll:!1}),setTimeout((function(){d.then((function(e){return n(u,void 0,void 0,(function(){var r,n,s,a,c,d;return o(this,(function(o){switch(o.label){case 0:return le(this.tag,"ECP问答请求成功"),console.log(e),r=e.Cnvs_Cntnt,n=void 0===r?"":r,s=e.Bsn_Parm_Tp,[4,i.autoAction((u=n,u.replace(/app|APP/g,"诶批批").replace(/logo/g,"搂狗").replace("E超人","亿超人").replace(/ATM|atm/g,"诶踢爱慕").replace(/iPhone/g,"爱凤").replace(/u|U/g,"优").replace(/a|A/g,"诶").replace(/p|P/g,"批").replace(/i|I/g,"艾").replace(/n|N/g,"嗯").replace(/v|V/g,"微").replace(/x|X/g,"艾克四")))];case 1:a=o.sent();try{(c=document.querySelector("#ttsa video"))&&c.play()}catch(e){}return d=0,"2"!==s&&"5"!==s||(d=0),setTimeout((function(){i.sendText((null==a?void 0:a.data)||n)}),d),t&&t(e),[2]}var u}))}))}))})),[2,d]):[2,this.http.send({method:"POST",path:"/business/chat/",body:r({req_type:"1",sessionid:this.sessionId},c)}).then((function(e){console.log(e)})).catch((function(e){le(u.tag,JSON.stringify(e))}))]}))}))},i.prototype.logoutECP=function(e,t){return n(this,void 0,void 0,(function(){var n,i,s,a,c=this;return o(this,(function(o){return n=this,i=Object.assign(e,{req_type:"1"}),s=r({},i),this.ajax?(le(this.tag,"logoutECP()"),a=this.ajaxPromise.post({code:be,data:s}),setTimeout((function(){a.then((function(e){le(c.tag,"ECP注销成功"),n.closeRoom(),t&&t(e)}))})),[2,a]):[2,null]}))}))},i.prototype.asr=function(e){return n(this,void 0,void 0,(function(){var t=this;return o(this,(function(r){return le(this.tag,"语音 base64Data"),console.log(e),[2,this.http.send({method:"POST",path:we(this.options.bizMode,"asr"),body:{req_type:"1",data:e}}).then((function(e){return console.log(e),e})).catch((function(e){le(t.tag,JSON.stringify(e))}))]}))}))},i.prototype.predict=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){return le(this.tag,"语音 predict，s功能暂无"),console.log(e),[2]}))}))},i}(xe);window.FTC_TTSA=De;
